<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>android 逆向(xctf) | wanan</title><meta name="keywords" content="android  re,xctf"><meta name="author" content="wanan"><meta name="copyright" content="wanan"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="基础android 直接拖进jeb package com.example.test.ctf02;import android.content.Intent;import android.os.Bundle;import android.support.v7.app.AppCompatActivity;import android.view.View.OnClickListener;import">
<meta property="og:type" content="article">
<meta property="og:title" content="android 逆向(xctf)">
<meta property="og:url" content="https://www.wanan.red/353ff66c.html">
<meta property="og:site_name" content="wanan">
<meta property="og:description" content="基础android 直接拖进jeb package com.example.test.ctf02;import android.content.Intent;import android.os.Bundle;import android.support.v7.app.AppCompatActivity;import android.view.View.OnClickListener;import">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.pixabay.com/photo/2016/10/22/17/46/mountains-1761292_1280.jpg">
<meta property="article:published_time" content="2023-01-08T11:58:45.191Z">
<meta property="article:modified_time" content="2023-01-22T12:29:38.117Z">
<meta property="article:author" content="wanan">
<meta property="article:tag" content="android  re">
<meta property="article:tag" content="xctf">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.pixabay.com/photo/2016/10/22/17/46/mountains-1761292_1280.jpg"><link rel="shortcut icon" href="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/202303181050845.jpeg"><link rel="canonical" href="https://www.wanan.red/353ff66c"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="Lkrie_55AalLqll4AtBs-NEomlv8QQYHGMx1V0cbq88"/><meta name="baidu-site-verification" content="code-h7qMMwh8fd"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?0a85e115f35e16b8da9503b0d77633ca";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-FYB0HL88QE"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-FYB0HL88QE');
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'android 逆向(xctf)',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-01-22 20:29:38'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.0.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/202303181050845.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">128</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">97</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">113</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.pixabay.com/photo/2016/10/22/17/46/mountains-1761292_1280.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">wanan</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">android 逆向(xctf)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-01-08T11:58:45.191Z" title="发表于 2023-01-08 19:58:45">2023-01-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-01-22T12:29:38.117Z" title="更新于 2023-01-22 20:29:38">2023-01-22</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/re/">re</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/re/android-%E9%80%86%E5%90%91-xctf/">android 逆向(xctf)</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>29分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="android 逆向(xctf)"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="基础android"><a href="#基础android" class="headerlink" title="基础android"></a>基础android</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230103195708866.png" alt="image-20230103195708866"></p>
<p>直接拖进jeb</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.test.ctf02;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.view.View.OnClickListener;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Button login;</span><br><span class="line">    <span class="keyword">private</span> EditText passWord;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>  <span class="comment">// android.support.v7.app.AppCompatActivity</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle arg3)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(arg3);</span><br><span class="line">        <span class="built_in">this</span>.setContentView(<span class="number">0x7F04001A</span>);  <span class="comment">// layout:acticity_main_1</span></span><br><span class="line">        <span class="built_in">this</span>.passWord = (EditText)<span class="built_in">this</span>.findViewById(<span class="number">0x7F0B0055</span>);  <span class="comment">// id:passWord</span></span><br><span class="line">        <span class="built_in">this</span>.login = (Button)<span class="built_in">this</span>.findViewById(<span class="number">0x7F0B0056</span>);  <span class="comment">// id:button</span></span><br><span class="line">        <span class="built_in">this</span>.login.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span>  <span class="comment">// android.view.View$OnClickListener</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View arg7)</span> &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> MainActivity.<span class="built_in">this</span>.passWord.getText().toString();</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">new</span> <span class="title class_">Check</span>().checkPassword(str)) &#123;</span><br><span class="line">                    <span class="comment">//这里调了 Check() 的checkPassword</span></span><br><span class="line">                    Toast.makeText(MainActivity.<span class="built_in">this</span>, <span class="string">&quot;Good,Please go on!&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                    <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(MainActivity.<span class="built_in">this</span>, MainActivity2.class);</span><br><span class="line">                    MainActivity.<span class="built_in">this</span>.startActivity(intent);</span><br><span class="line">                    MainActivity.<span class="built_in">this</span>.finish();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                Toast.makeText(MainActivity.<span class="built_in">this</span>, <span class="string">&quot;Failed&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.test.ctf02;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Check</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkPassword</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="type">char</span>[] pass = str.toCharArray();</span><br><span class="line">        <span class="keyword">if</span>(pass.length != <span class="number">12</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(len &lt; pass.length) &#123;</span><br><span class="line">            pass[len] = (<span class="type">char</span>)(<span class="number">0x9B</span> - len - pass[len]);</span><br><span class="line">            <span class="keyword">if</span>(pass[len] == <span class="number">0x30</span> &amp;&amp; len &lt; <span class="number">12</span>) &#123;</span><br><span class="line">                ++len;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>跑一下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">12</span>):</span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">128</span>):</span><br><span class="line">        tmp = <span class="number">0x9B</span> - i - s</span><br><span class="line">        <span class="keyword">if</span> tmp == <span class="number">0x30</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">chr</span>(s),end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230103201937799.png" alt="image-20230103201937799"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230103201943910.png" alt="image-20230103201943910"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230103202804837.png" alt="image-20230103202804837"></p>
<h1 id="Android2-0"><a href="#Android2-0" class="headerlink" title="Android2.0"></a>Android2.0</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230103210009094.png" alt="image-20230103210009094"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230103210021262.png" alt="image-20230103210021262"></p>
<p>这里可以看到调用了本地库 native 其中方法是getResult</p>
<p>将apk改名zip然后解压</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230103210054746.png" alt="image-20230103210054746"></p>
<p>使用dia打开</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230103210321662.png" alt="image-20230103210321662"></p>
<p>可见这里首先创建了几个变量 然后调用了Init 我们先看 Init</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="type">int</span> __fastcall <span class="title function_">Init</span><span class="params">(<span class="type">int</span> result, <span class="type">char</span> *a2, <span class="type">char</span> *a3, <span class="type">const</span> <span class="type">char</span> *a4, <span class="type">int</span> a5)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// 123456</span></span><br><span class="line">    <span class="type">int</span> v5; <span class="comment">// r5</span></span><br><span class="line">    <span class="type">int</span> v6; <span class="comment">// r10</span></span><br><span class="line">    <span class="type">int</span> v7; <span class="comment">// r6</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( a5 &lt; <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        v6 = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        v5 = <span class="number">0</span>;</span><br><span class="line">        v6 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">            v7 = v5 % <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">if</span> ( v5 % <span class="number">3</span> == <span class="number">2</span> )</span><br><span class="line">            &#123;</span><br><span class="line">                a3[v5 / <span class="number">3u</span>] = a4[v5];</span><br><span class="line"><span class="comment">//        a3[0] = 1</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ( v7 == <span class="number">1</span> )</span><br><span class="line">            &#123;</span><br><span class="line">                a2[v5 / <span class="number">3u</span>] = a4[v5];</span><br><span class="line"><span class="comment">//      a2[0] = 2</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ( !v7 )</span><br><span class="line">            &#123;</span><br><span class="line">                ++v6;</span><br><span class="line">                *(_BYTE *)(result + v5 / <span class="number">3u</span>) = a4[v5];</span><br><span class="line"><span class="comment">//                这里是将result中的值赋值为 a4[3 ] 其实这里是 ida 的问题 代码应该是和上面一样的 </span></span><br><span class="line">            &#125;</span><br><span class="line">            ++v5;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> ( a5 != v5 );</span><br><span class="line">    &#125;</span><br><span class="line">    *(_BYTE *)(result + v6) = <span class="number">0</span>;</span><br><span class="line">    a2[v6] = <span class="number">0</span>;</span><br><span class="line">    a3[v6] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也就是说上面的代码就是将 15个字符分组 然后将 a4[0&#x2F;3&#x2F;6&#x2F;9&#x2F;12] 赋值给了a3 将a4[1&#x2F;4&#x2F;7&#x2F;10&#x2F;13]赋值给了a3  将a4[2&#x2F;5&#x2F;8&#x2F;11&#x2F;14]赋值给了result 并返回了result</p>
<p>接着调完Init 又以v5 调用了 First 其中这里的v5就是在init中的result</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">bool</span> __fastcall <span class="title function_">First</span><span class="params">(<span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// r1</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i != <span class="number">4</span>; ++i )</span><br><span class="line">    a1[i] = (<span class="number">2</span> * a1[i]) ^ <span class="number">0x80</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">strcmp</span>(a1, <span class="string">&quot;LN^dl&quot;</span>) == <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//比较字符串 a1 和 LN^dl 的大小 这里需要返回真所以 a1要和LN^dl相等</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">bool</span> __fastcall <span class="title function_">Java_com_example_test_ctf03_JNI_getResult</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2, <span class="type">int</span> a3)</span></span><br><span class="line">&#123;</span><br><span class="line">    _BOOL4 v3; <span class="comment">// r4</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *v4; <span class="comment">// r8</span></span><br><span class="line">    <span class="type">char</span> *v5; <span class="comment">// r6</span></span><br><span class="line">    <span class="type">char</span> *v6; <span class="comment">// r4</span></span><br><span class="line">    <span class="type">char</span> *v7; <span class="comment">// r5</span></span><br><span class="line">    <span class="type">int</span> i; <span class="comment">// r0</span></span><br><span class="line">    <span class="type">int</span> j; <span class="comment">// r0</span></span><br><span class="line"></span><br><span class="line">    v3 = <span class="number">0</span>;</span><br><span class="line">    v4 = (<span class="type">const</span> <span class="type">char</span> *)(*(<span class="type">int</span> (__fastcall **)(<span class="type">int</span>, <span class="type">int</span>, _DWORD))(*(_DWORD *)a1 + <span class="number">676</span>))(a1, a3, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">strlen</span>(v4) == <span class="number">15</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        v5 = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">1u</span>);</span><br><span class="line">        v6 = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">1u</span>);</span><br><span class="line">        v7 = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">1u</span>);</span><br><span class="line">        Init(v5, v6, v7, v4, <span class="number">15</span>);</span><br><span class="line">        <span class="keyword">if</span> ( !First(v5) )</span><br><span class="line"><span class="comment">//            First(v5)肯定是要返回真的</span></span><br><span class="line">            <span class="keyword">goto</span> LABEL_6;</span><br><span class="line">        <span class="keyword">for</span> ( i = <span class="number">0</span>; i != <span class="number">4</span>; ++i )</span><br><span class="line">            v6[i] ^= v5[i];</span><br><span class="line"><span class="comment">//        v6与v5异或</span></span><br><span class="line">        <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(v6, a5) )</span><br><span class="line"><span class="comment">//        如果v6等于a5 这里a5其实是未知的</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> ( j = <span class="number">0</span>; j != <span class="number">4</span>; ++j )</span><br><span class="line">                v7[j] ^= v6[j];</span><br><span class="line"><span class="comment">//            这里是v7和v6异或</span></span><br><span class="line">            v3 = <span class="built_in">strcmp</span>(v7, <span class="string">&quot;AFBo&#125;&quot;</span>) == <span class="number">0</span>;</span><br><span class="line"><span class="comment">//            如果v7和AFBo&#125; 相等就返回真</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            LABEL_6:</span><br><span class="line">            v3 = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里 双击一下a5</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104000156127.png" alt="image-20230104000156127"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104000302052.png" alt="image-20230104000302052"></p>
<p>我们知道数组是以0结尾  那么这里的 a5就是</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">5-0x16x61</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">r1 = [<span class="built_in">ord</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">list</span>(<span class="string">&quot;LN^dl&quot;</span>)]</span><br><span class="line">r2 = [<span class="number">32</span>,<span class="number">53</span>,<span class="number">45</span>,<span class="number">0x16</span>,<span class="number">0x61</span>]</span><br><span class="line">r3 = [<span class="built_in">ord</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">list</span>(<span class="string">&quot;AFBo&#125;&quot;</span>)]</span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span>  i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    <span class="keyword">if</span>(i&lt;<span class="number">4</span>):</span><br><span class="line">        r3[i]^=r2[i]</span><br><span class="line">        r2[i]^=r1[i]</span><br><span class="line">        r1[i] = (r1[i]^<span class="number">0x80</span>)//<span class="number">2</span></span><br><span class="line">    flag += <span class="built_in">chr</span>(r1[i])</span><br><span class="line">    flag += <span class="built_in">chr</span>(r2[i])</span><br><span class="line">    flag += <span class="built_in">chr</span>(r3[i])</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104012701579.png" alt="image-20230104012701579"></p>
<h1 id="APK逆向"><a href="#APK逆向" class="headerlink" title="APK逆向"></a>APK逆向</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104134629309.png" alt="image-20230104134629309"></p>
<p>逻辑很简单 拿出来执行一下就行</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Test</span> <span class="variable">test</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line">        test.checkSN(<span class="string">&quot;Tenshine&quot;</span>,<span class="string">&quot;1234567890123456789012&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">checkSN</span><span class="params">(String userName, String sn)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(userName == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(userName.length() != <span class="number">0</span> &amp;&amp; (sn != <span class="literal">null</span> &amp;&amp; sn.length() == <span class="number">22</span>)) &#123;</span><br><span class="line">                <span class="type">MessageDigest</span> <span class="variable">messageDigest0</span> <span class="operator">=</span> MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">                messageDigest0.reset();</span><br><span class="line">                messageDigest0.update(userName.getBytes());</span><br><span class="line">                <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> Test.toHexString(messageDigest0.digest(), <span class="string">&quot;&quot;</span>);</span><br><span class="line">                <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">                <span class="type">int</span> i;</span><br><span class="line">                <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; s2.length(); i += <span class="number">2</span>) &#123;</span><br><span class="line">                    sb.append(((<span class="type">char</span>)s2.charAt(i)));</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">String</span> <span class="variable">z</span> <span class="operator">=</span> <span class="string">&quot;flag&#123;&quot;</span> + sb.toString() + <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">                System.out.println(z);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(NoSuchAlgorithmException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">toHexString</span><span class="params">(<span class="type">byte</span>[] bytes, String separator)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">hexString</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="type">int</span> i$;</span><br><span class="line">        <span class="keyword">for</span>(i$ = <span class="number">0</span>; i$ &lt; bytes.length; ++i$) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> Integer.toHexString(bytes[i$] &amp; <span class="number">0xFF</span>);</span><br><span class="line">            <span class="keyword">if</span>(s1.length() == <span class="number">1</span>) &#123;</span><br><span class="line">                hexString.append(<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            hexString.append(s1).append(separator);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> hexString.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104134659794.png" alt="image-20230104134659794"></p>
<h1 id="人民的名义-抓捕赵德汉1-200"><a href="#人民的名义-抓捕赵德汉1-200" class="headerlink" title="人民的名义-抓捕赵德汉1-200"></a>人民的名义-抓捕赵德汉1-200</h1><p>这里可以看到 调用了 loadCheckerObject 返回了 一个 CheckInterface 对象然后调用了其中的 checkPassword方法</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104143507313.png" alt="image-20230104143507313"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104143909856.png" alt="image-20230104143909856"></p>
<p>这里首先获取了 &#x2F;ClassEnc 根目录下的 &#x2F;ClassEnc 加密文件 接着解密这个文件的内容 并创建一个对象返回 那么我们现在需要去解密一下 &#x2F;ClassEnc 的内容 其中密钥在第一行给了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line">key = <span class="string">&quot;bb27630cf264f8567d185008c10c3f96&quot;</span></span><br><span class="line">keybyte= <span class="built_in">bytes</span>.fromhex(key)</span><br><span class="line">aes =AES.new(keybyte,AES.MODE_ECB)</span><br><span class="line"><span class="comment"># MODE_ECB 是指密码本模式</span></span><br><span class="line">data = <span class="built_in">bytearray</span>(os.path.getsize(<span class="string">&quot;ClassEnc&quot;</span>))</span><br><span class="line"><span class="comment"># 获取一个指定长度的数组</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;ClassEnc&quot;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f :</span><br><span class="line">    f.readinto(data)</span><br><span class="line">    f.close()</span><br><span class="line">dec = aes.decrypt(data)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;dec.class&quot;</span>,<span class="string">&quot;ba&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(dec)</span><br><span class="line">    f.close()</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104145238999.png" alt="image-20230104145238999"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104145319460.png" alt="image-20230104145319460"></p>
<p>这里可以发现进行了 qeuals </p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104145350327.png" alt="image-20230104145350327"></p>
<p>其实这里 在源jar包中还有一个class</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104145426760.png" alt="image-20230104145426760"></p>
<p>这里的内容和我们解密出来的是一样的</p>
<p>monkey99</p>
<p>其实这里利用java去获取会更加简单</p>
<p>下面是修改后的loadCheckerObject方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> CheckInterface <span class="title function_">loadCheckerObject</span><span class="params">()</span> <span class="keyword">throws</span> IOException, NoSuchAlgorithmException, NoSuchPaddingException, InvalidKeyException, IllegalBlockSizeException, BadPaddingException, ClassFormatError, InstantiationException, IllegalAccessException &#123;</span><br><span class="line">    <span class="type">CheckPassword</span> <span class="variable">mycl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CheckPassword</span>();</span><br><span class="line">    <span class="type">FileInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;src/main/java/ClassEnc&quot;</span>);</span><br><span class="line">    <span class="type">ByteArrayOutputStream</span> <span class="variable">bout</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">    <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">512</span>];</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> in.read(bytes);</span><br><span class="line">        <span class="keyword">if</span> (len &lt;= -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="type">byte</span>[] myClassBytesEnc = bout.toByteArray();</span><br><span class="line">            in.close();</span><br><span class="line">            <span class="type">SecretKeySpec</span> <span class="variable">secretKeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(hexStringToByteArray(hexKey), <span class="string">&quot;AES&quot;</span>);</span><br><span class="line">            <span class="type">Cipher</span> <span class="variable">decAEScipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;AES&quot;</span>);</span><br><span class="line">            decAEScipher.init(<span class="number">2</span>, secretKeySpec);</span><br><span class="line">            <span class="type">byte</span>[] myClassBytes = decAEScipher.doFinal(myClassBytesEnc);</span><br><span class="line"></span><br><span class="line">            <span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;dec.class&quot;</span>);</span><br><span class="line">            fileOutputStream.write(myClassBytes);</span><br><span class="line">            fileOutputStream.close();</span><br><span class="line">            <span class="keyword">return</span> (CheckInterface) mycl.defineClass(<span class="literal">null</span>, myClassBytes, <span class="number">0</span>, myClassBytes.length).newInstance();</span><br><span class="line">        &#125;</span><br><span class="line">        bout.write(bytes, <span class="number">0</span>, len);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重新运行下程序就能拿到class类</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104153106002.png" alt="image-20230104153106002"></p>
<p>或者尝试自己去解密下aes</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.IvParameterSpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.security.Key;</span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">hexKey</span> <span class="operator">=</span> <span class="string">&quot;bb27630cf264f8567d185008c10c3f96&quot;</span>;</span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">classEnc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;src/main/java/ClassEnc&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] bytes = classEnc.readAllBytes();</span><br><span class="line">        <span class="type">SecretKeySpec</span> <span class="variable">keySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(hexStringToByteArray(hexKey), <span class="string">&quot;AES&quot;</span>);</span><br><span class="line">        <span class="type">Cipher</span> <span class="variable">aes1</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;AES&quot;</span>);</span><br><span class="line">        aes1.init(<span class="number">2</span>,keySpec);</span><br><span class="line">        <span class="type">byte</span>[] decydata = aes1.doFinal(bytes);</span><br><span class="line"></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;dec.class&quot;</span>);</span><br><span class="line">        fileOutputStream.write(decydata);</span><br><span class="line">        fileOutputStream.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">byte</span>[] hexStringToByteArray(String s) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> s.length();</span><br><span class="line">        <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[len / <span class="number">2</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; i += <span class="number">2</span>) &#123;</span><br><span class="line">            data[i / <span class="number">2</span>] = (<span class="type">byte</span>) ((Character.digit(s.charAt(i), <span class="number">16</span>) &lt;&lt; <span class="number">4</span>) + Character.digit(s.charAt(i + <span class="number">1</span>), <span class="number">16</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="boomshakalaka-3"><a href="#boomshakalaka-3" class="headerlink" title="boomshakalaka-3"></a>boomshakalaka-3</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104161222839.png" alt="image-20230104161222839"></p>
<p>可以看到new 了一个alei</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104161357336.png" alt="image-20230104161357336"></p>
<p>在a类的构造方法中SharedPreferences 是android中常见的存储方式  这里就是以 arg2 打开一个文件</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104161523151.png" alt="image-20230104161523151"></p>
<p>因此在 &#x2F;data&#x2F;data&#x2F;packgaename 对应目录下生成对应文件</p>
<p>可以看到以DATA 存储了一串字符串</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104162043289.png" alt="image-20230104162043289"></p>
<p>解码发现有乱码</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104162051077.png" alt="image-20230104162051077"></p>
<p>接着去分析so文件</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104162413195.png" alt="image-20230104162413195"></p>
<p>找到 updateScore</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104162509469.png" alt="image-20230104162509469"></p>
<p>这里应该是按分数追加字符串 接着调用了setStringForKey</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104162601669.png" alt="image-20230104162601669"></p>
<p>然后调用了java层的 setStringForKey</p>
<p>零分的时候的图</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&#x27;1.0&#x27; encoding=&#x27;utf-8&#x27; standalone=&#x27;yes&#x27; ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span> <span class="attr">name</span>=<span class="string">&quot;HighestScore&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;DATA&quot;</span>&gt;</span>MGN0<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">boolean</span> <span class="attr">name</span>=<span class="string">&quot;isHaveSaveFileXml&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>第一局</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&#x27;1.0&#x27; encoding=&#x27;utf-8&#x27; standalone=&#x27;yes&#x27; ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span> <span class="attr">name</span>=<span class="string">&quot;HighestScore&quot;</span> <span class="attr">value</span>=<span class="string">&quot;6000&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;DATA&quot;</span>&gt;</span>MGN0ZntDMGNvUzJkX0FuRHJvMWRfRzRVdz99<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">boolean</span> <span class="attr">name</span>=<span class="string">&quot;isHaveSaveFileXml&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>第二局</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&#x27;1.0&#x27; encoding=&#x27;utf-8&#x27; standalone=&#x27;yes&#x27; ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span> <span class="attr">name</span>=<span class="string">&quot;HighestScore&quot;</span> <span class="attr">value</span>=<span class="string">&quot;6000&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;DATA&quot;</span>&gt;</span>MGN0ZntDMGNvUzJkX0FuRHJvMWRfRzRVdz99ZntDMGNvUzJkX0FuRHJvMWRfRzdz99<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">boolean</span> <span class="attr">name</span>=<span class="string">&quot;isHaveSaveFileXml&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以发现 MGN0  是刚开始加上的</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ZntDMGNvUzJkX0FuRHJvMWRfRzRVdz99</span><br><span class="line">ZntDMGNvUzJkX0FuRHJvMWRfRzRVdz99ZntDMGNvUzJkX0FuRHJvMWRfRzdz99</span><br><span class="line">ZntDMGNvUzJkX0FuRHJvMWRfRzRVdz99ZntDMGNvUzJkX0FuRHJvMWRfRzdz99ZntDMGNvUzJkX0FuRHJvMWdz99ZntDMGNvUzJkX0FuRHJvMWRfRzRVdz99ZntDMGNvUzJkX0FuRHJvMWRfBtdz99</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MGN0ZntDMGNvUzJkX0FuRHJv  MWRf</span><br></pre></td></tr></table></figure>

<p>这里逐渐发现分数是从MGN0ZntDMGNvUzJkX0FuRHJv 开始添加直到dz99结束</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104164512284.png" alt="image-20230104164512284"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MGN0ZntDMGNvUzJkX0FuRHJvMWRfRzBtRV9Zb1VfS24wdz99</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104164609061.png" alt="image-20230104164609061"></p>
<h1 id="easy-apk"><a href="#easy-apk" class="headerlink" title="easy-apk"></a>easy-apk</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104175913323.png" alt="image-20230104175913323"></p>
<p>可以看到有个 equals 其中new 了一个新的base64</p>
<p>自定义的字符</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104175946291.png" alt="image-20230104175946291"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = [<span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;O&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;j&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;/&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    <span class="built_in">print</span>(i,end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104180011920.png" alt="image-20230104180011920"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104175849427.png" alt="image-20230104175849427"></p>
<h1 id="frida使用"><a href="#frida使用" class="headerlink" title="frida使用"></a>frida使用</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip install frida</span><br><span class="line">pip install frida-tools</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104233728431.png" alt="image-20230104233728431"></p>
<p>这里可以看到安装的版本是 16.0.8</p>
<p>查看手机信息</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">adb shell getprop ro.product.cpu.abi</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104234009173.png" alt="image-20230104234009173"></p>
<p>下载frida 服务端  <a target="_blank" rel="noopener" href="https://github.com/frida/frida/releases">https://github.com/frida/frida/releases</a></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104234137381.png" alt="image-20230104234137381"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">adb push .\frida-server-16.0.8-android-x86 /data/local/tmp</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">adb root</span><br><span class="line">adb shell</span><br><span class="line">cd /data/local/tmp/</span><br><span class="line">chmod +x frida-server-16.0.8-android-x86</span><br><span class="line">./frida-server-16.0.8-android-x86</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104234951330.png" alt="image-20230104234951330"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">frida-ps -U</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104235609960.png" alt="image-20230104235609960"></p>
<p>将一个脚本注入到 Android进程</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">frida -U -l myhook.js com.xxx.xxx</span><br><span class="line">-U 指定对use设备操作</span><br><span class="line">-l 指定加载一个javascript脚本</span><br><span class="line">最后指定一个进程名 如果想指定进程pid 使用 -p选项 正在运行的进程用 frida-ps -U查看</span><br></pre></td></tr></table></figure>

<p>frida运行过程中,执行 %resume重新注入 %reload 重新加载脚本 执行exit结束</p>
<h2 id="hook"><a href="#hook" class="headerlink" title="hook"></a>hook</h2><h3 id="载入类"><a href="#载入类" class="headerlink" title="载入类"></a>载入类</h3><p>java.use方法用于声明一个java类</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">var StringClass=Java.use(&quot;java.lang.String&quot;);</span><br></pre></td></tr></table></figure>

<h3 id="函数参数类型表示"><a href="#函数参数类型表示" class="headerlink" title="函数参数类型表示"></a>函数参数类型表示</h3><p>对于基本类型直接用java中的表示即可</p>
<p>基本类型数组 用左中括号接上基本类型的缩写</p>
<p>基本类型缩写表示表：</p>
<table>
<thead>
<tr>
<th>基本类型</th>
<th>缩写</th>
</tr>
</thead>
<tbody><tr>
<td>boolean</td>
<td>Z</td>
</tr>
<tr>
<td>byte</td>
<td>B</td>
</tr>
<tr>
<td>char</td>
<td>C</td>
</tr>
<tr>
<td>double</td>
<td>D</td>
</tr>
<tr>
<td>float</td>
<td>F</td>
</tr>
<tr>
<td>int</td>
<td>I</td>
</tr>
<tr>
<td>long</td>
<td>J</td>
</tr>
<tr>
<td>short</td>
<td>S</td>
</tr>
</tbody></table>
<p>例如int[] 类型要写成[I</p>
<p>任意类 直接写完整类名即可</p>
<p>数组对象 需要加[ 接上完整类名</p>
<h3 id="带参数的构造方法"><a href="#带参数的构造方法" class="headerlink" title="带参数的构造方法"></a>带参数的构造方法</h3><p>修改参数为byte[]类型的构造函数的实现</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ClassName.$init.overload(&#x27;[B&#x27;).implementation=function(param)&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>ClassName 是使用java.use定义的类 param是可以在函数体中访问的类</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ClassName.$init.overload(&#x27;[B&#x27;,&#x27;int&#x27;,&#x27;int&#x27;).implementation=function(param1,param2,param3)&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>调用源构造函数</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ClassName.$init.overload().implementation=function()&#123;</span><br><span class="line">	this.$init();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改函数名为func,参数为byte[]类型的函数实现</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ClassName.func.overload(&#x27;[B&#x27;).implementation=function(param)&#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="调用函数"><a href="#调用函数" class="headerlink" title="调用函数"></a>调用函数</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">var ClassName=java.use(&quot;com.test.ClassName&quot;);</span><br><span class="line">var instance = ClassName.$new();</span><br><span class="line">$new表示一个构造函数</span><br><span class="line">instance.func();</span><br></pre></td></tr></table></figure>

<h3 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">var StringClass = Java.use(&quot;java.lang.String&quot;);</span><br><span class="line">var NewTypeClas=Java.cast(variable,StringClass)</span><br></pre></td></tr></table></figure>

<h2 id="实例场景"><a href="#实例场景" class="headerlink" title="实例场景"></a>实例场景</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> frida, <span class="type">sys</span></span><br><span class="line"></span><br><span class="line"><span class="variable">jscode</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">if(Java.available)&#123;</span></span><br><span class="line"><span class="string">    Java.perform(function()&#123;</span></span><br><span class="line"><span class="string">        var MainActivity = Java.use(&quot;com.luoyesiqiu.crackme.MainActivity&quot;);</span></span><br><span class="line"><span class="string">        MainActivity.isExcellent.overload(&quot;int&quot;,&quot;int&quot;).implementation=function(chinese,math)&#123;</span></span><br><span class="line"><span class="string">            console.log(&quot;[javascript] isExcellent be called.&quot;);</span></span><br><span class="line"><span class="string">            send(&quot;isExcellent be called.&quot;);</span></span><br><span class="line"><span class="string">            return this.isExcellent(95,96);      </span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">def <span class="title function_">on_message</span><span class="params">(message, data)</span>:</span><br><span class="line">    <span class="keyword">if</span> message[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;send&#x27;</span>:</span><br><span class="line">        print(<span class="string">&quot; &#123;0&#125;&quot;</span>.format(message[<span class="string">&#x27;payload&#x27;</span>]))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(message)</span><br><span class="line">pass</span><br><span class="line"></span><br><span class="line"># 查找USB设备并附加到目标进程</span><br><span class="line">session = frida.get_usb_device().attach(<span class="string">&#x27;com.luoyesiqiu.crackme&#x27;</span>)</span><br><span class="line"># 在目标进程里创建脚本</span><br><span class="line">script = session.create_script(jscode)</span><br><span class="line"># 注册消息回调</span><br><span class="line">script.on(<span class="string">&#x27;message&#x27;</span>, on_message)</span><br><span class="line">print(<span class="string">&#x27; Start attach&#x27;</span>)</span><br><span class="line"># 加载创建好的javascript脚本</span><br><span class="line">script.load()</span><br><span class="line"># 读取系统输入</span><br><span class="line">sys.stdin.read()</span><br></pre></td></tr></table></figure>

<h1 id="app2"><a href="#app2" class="headerlink" title="app2"></a>app2</h1><p>这里空校验通过之后初始化了一个 SecondActivity对象</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104202713350.png" alt="image-20230104202713350"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104202751263.png" alt="image-20230104202751263"></p>
<p>其中调用了 Encryto 去处理数据</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104202816817.png" alt="image-20230104202816817"></p>
<p>这里加载了本地的 so文件</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104202854920.png" alt="image-20230104202854920"></p>
<p>打开后直接搜就能发现 这里有AES密钥 128位 ECB模式</p>
<p>直接拿去解下密</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104202943584.png" alt="image-20230104202943584"></p>
<p>发现不对   这里还有一串</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104203838254.png" alt="image-20230104203838254"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230104202457359.png" alt="image-20230104202457359"></p>
<h2 id="frida"><a href="#frida" class="headerlink" title="frida"></a>frida</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./frida-server-16.0.8-android-x86</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230107212203803.png" alt="image-20230107212203803"></p>
<p>尝试hook这个decode函数</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230105165203368.png" alt="image-20230105165203368"></p>
<p>先查看需要附加的进程</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">frida-ps -U</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230105192719805.png" alt="image-20230105192719805"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    jscode = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Java.perform(function ()&#123;</span></span><br><span class="line"><span class="string">    //Java.perform 用于在jva层执行js代码</span></span><br><span class="line"><span class="string">    var nativePointer= Module.findExportByName(&quot;libJNIEncrypt.so&quot;,&quot;AES_128_ECB_PKCS5Padding_Encrypt&quot;);</span></span><br><span class="line"><span class="string">    //用于查找模块中的一个函数</span></span><br><span class="line"><span class="string">    send(&quot;native: &quot;+nativePointer);</span></span><br><span class="line"><span class="string">    Interceptor.attach(nativePointer,&#123;</span></span><br><span class="line"><span class="string">        //将一个拦截器附加到 函数上 </span></span><br><span class="line"><span class="string">        onEnter:function (args) &#123;</span></span><br><span class="line"><span class="string">            //这里是在函数调用前执行的 args是函数的参数列表</span></span><br><span class="line"><span class="string">            send(args);</span></span><br><span class="line"><span class="string">            //send想frida控制台输出信息</span></span><br><span class="line"><span class="string">            console.log(&#x27;args[0]&#x27;,Memory.readByteArray(args[0],20))</span></span><br><span class="line"><span class="string">            //这里使用Memory.readByteArray 读取处理参数的内容</span></span><br><span class="line"><span class="string">            console.log(&#x27;args[1]&#x27;,Memory.readByteArray(args[1],20))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        onLeave:function (retval) &#123;</span></span><br><span class="line"><span class="string">            //这里是函数调用结束执行的 retval是函数返回值</span></span><br><span class="line"><span class="string">            send(retval);</span></span><br><span class="line"><span class="string">            console.log(&#x27;output&#x27;,Memory.readByteArray(retval,30))</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">message</span>(<span class="params">message,data</span>):</span><br><span class="line">        <span class="comment"># 用于接收frida的信息</span></span><br><span class="line">        <span class="keyword">if</span> message[<span class="string">&quot;type&quot;</span>] == <span class="string">&#x27;send&#x27;</span>:</span><br><span class="line">            <span class="comment"># 如果类型等于 send</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[*] &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(message[<span class="string">&#x27;payload&#x27;</span>]))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(message)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    device = frida.get_usb_device()</span><br><span class="line">    <span class="comment"># 获取当前的usb设备</span></span><br><span class="line">    <span class="built_in">print</span>(device)</span><br><span class="line">    process = device.attach(<span class="string">&quot;app漏洞第二题&quot;</span>)</span><br><span class="line">    <span class="comment"># 附加到相关进程</span></span><br><span class="line">    <span class="built_in">print</span>(process)</span><br><span class="line">    script = process.create_script(jscode)</span><br><span class="line">    <span class="comment"># 进程所需要附加的脚本</span></span><br><span class="line"></span><br><span class="line">    script.on(<span class="string">&quot;message&quot;</span>, message)</span><br><span class="line">    <span class="comment"># 将message函数与脚本内容绑定</span></span><br><span class="line">    script.load()</span><br><span class="line">    <span class="comment"># 加载脚本</span></span><br><span class="line">    sys.stdin.read()</span><br><span class="line">    <span class="comment"># 执行完停止等待用户输入</span></span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230105192703689.png" alt="image-20230105192703689"></p>
<p>像这样调用也可以</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">ClassName</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.tencent.testvuln.c.Encryto&quot;</span>);</span><br><span class="line"><span class="comment">//    这里先获取了源类</span></span><br><span class="line">    <span class="title class_">ClassName</span>.<span class="property">doRawData</span>.<span class="property">implementation</span>=<span class="keyword">function</span> (<span class="params">obj,str</span>) &#123;</span><br><span class="line">        <span class="comment">//调用  implementation 修改了 doRawData函数的实现</span></span><br><span class="line">        <span class="keyword">let</span> ret = <span class="variable language_">this</span>.<span class="title function_">doRawData</span>(obj,str);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;obj=&gt;&quot;</span>,obj);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;st=&gt;&quot;</span>,str);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;doRawData ret =&gt;&quot;</span>,ret);</span><br><span class="line">    <span class="comment">//    先调用了源函数</span></span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230105195344149.png" alt="image-20230105195344149"></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">ClassName</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.tencent.testvuln.c.Encryto&quot;</span>);</span><br><span class="line"><span class="comment">//    这里先获取了源类</span></span><br><span class="line">    <span class="title class_">ClassName</span>.<span class="property">doRawData</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">obj, str</span>) &#123;</span><br><span class="line">        <span class="comment">//调用  implementation 修改了 doRawData函数的实现</span></span><br><span class="line">        <span class="keyword">let</span> decode = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.tencent.testvuln.c.Encryto&quot;</span>).<span class="title function_">decode</span>(obj, <span class="string">&quot;9YuQ2dk8CSaCe7DTAmaqAA==&quot;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;decode=&gt;&quot;</span>, decode);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230105195748031.png" alt="image-20230105195748031"></p>
<h1 id="easy-so"><a href="#easy-so" class="headerlink" title="easy-so"></a>easy-so</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230105202851870.png" alt="image-20230105202851870"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230105224041162.png" alt="image-20230105224041162"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">s=<span class="built_in">list</span>(<span class="string">&#x27;f72c5a36569418a20907b55be5bf95ad&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(s)-<span class="number">1</span>,<span class="number">2</span>):</span><br><span class="line">    tmp = s[i]</span><br><span class="line">    s[i] = s[i+<span class="number">1</span>]</span><br><span class="line">    s[i+<span class="number">1</span>] = tmp</span><br><span class="line">flag= <span class="string">&quot;&quot;</span>.join(s[<span class="built_in">len</span>(s)&gt;&gt;<span class="number">1</span>:]+s[<span class="number">0</span>:<span class="built_in">len</span>(s)&gt;&gt;<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;flag&#123;&quot;</span>+flag+<span class="string">&quot;&#125;&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230105224030289.png" alt="image-20230105224030289"></p>
<h1 id="app3"><a href="#app3" class="headerlink" title="app3"></a>app3</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230107153550332.png" alt="image-20230107153550332"></p>
<p>下载完成之后发现是 ab结尾的  .ab后缀的文件是android系统的备份文件格式 ,它分为加密和未加密两种类型,.ab文件的前24个字节是类似文件头的东西,如果是加密的,在24个字节中会有aes-256的标志,如果未加密.则在前20个字节中会有none的标识</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230107154500153.png" alt="image-20230107154500153"></p>
<p>下载解包软件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/nelenkov/android-backup-extractor/releases/download/master-20221109063121-8fdfc5e/abe.jar</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;C:\Program Files\Java\jdk-17.0.2\bin\java.exe&quot; -jar D:\Download\abe.jar  unpack D:\Download\and.ab and.tar</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230107154838996.png" alt="image-20230107154838996"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230107155110505.png" alt="image-20230107155110505"></p>
<p>在onCreate中调用了a()</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230107161152537.png" alt="image-20230107161152537"></p>
<p>注意看这里有两个 a类一个是在a包下一个不在</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230107161301068.png" alt="image-20230107161301068"></p>
<p>可以看到flag就放在数据库中</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230107161352021.png" alt="image-20230107161352021"></p>
<p>这里新建了a 对象 调了两个a() 在调之前调用了 a0.b</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230107161722055.png" alt="image-20230107161722055"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">a</span> <span class="variable">a0</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">a</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> a0.a(<span class="string">&quot;Stranger&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> a0.a(s + a0.b(s, <span class="string">&quot;123456&quot;</span>));</span><br><span class="line">        System.out.println(s1.substring(<span class="number">0</span>, <span class="number">7</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">b</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <span class="title function_">a</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">v</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">char</span>[] arr_c = &#123;<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>&#125;;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">MessageDigest</span> <span class="variable">messageDigest0</span> <span class="operator">=</span> MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">            messageDigest0.update(s.getBytes());</span><br><span class="line">            <span class="type">byte</span>[] arr_b = messageDigest0.digest();</span><br><span class="line">            <span class="type">char</span>[] arr_c1 = <span class="keyword">new</span> <span class="title class_">char</span>[arr_b.length * <span class="number">2</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">v1</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>(v &lt; arr_b.length) &#123;</span><br><span class="line">                <span class="type">byte</span> <span class="variable">b</span> <span class="operator">=</span> arr_b[v];</span><br><span class="line">                <span class="type">int</span> <span class="variable">v2</span> <span class="operator">=</span> v1 + <span class="number">1</span>;</span><br><span class="line">                arr_c1[v1] = arr_c[b &gt;&gt;&gt; <span class="number">4</span> &amp; <span class="number">15</span>];</span><br><span class="line">                v1 = v2 + <span class="number">1</span>;</span><br><span class="line">                arr_c1[v2] = arr_c[b &amp; <span class="number">15</span>];</span><br><span class="line">                ++v;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(arr_c1);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(Exception exception0) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <span class="title function_">b</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">v</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">char</span>[] arr_c = &#123;<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>&#125;;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">MessageDigest</span> <span class="variable">messageDigest0</span> <span class="operator">=</span> MessageDigest.getInstance(<span class="string">&quot;SHA-1&quot;</span>);</span><br><span class="line">            messageDigest0.update(s.getBytes());</span><br><span class="line">            <span class="type">byte</span>[] arr_b = messageDigest0.digest();</span><br><span class="line">            <span class="type">char</span>[] arr_c1 = <span class="keyword">new</span> <span class="title class_">char</span>[arr_b.length * <span class="number">2</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">v1</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>(v &lt; arr_b.length) &#123;</span><br><span class="line">                <span class="type">byte</span> <span class="variable">b</span> <span class="operator">=</span> arr_b[v];</span><br><span class="line">                <span class="type">int</span> <span class="variable">v2</span> <span class="operator">=</span> v1 + <span class="number">1</span>;</span><br><span class="line">                arr_c1[v1] = arr_c[b &gt;&gt;&gt; <span class="number">4</span> &amp; <span class="number">15</span>];</span><br><span class="line">                v1 = v2 + <span class="number">1</span>;</span><br><span class="line">                arr_c1[v2] = arr_c[b &amp; <span class="number">15</span>];</span><br><span class="line">                ++v;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(arr_c1);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(Exception exception0) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">a</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String a;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">a</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.a = <span class="string">&quot;yaphetshan&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">a</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">b</span>();</span><br><span class="line">        <span class="keyword">return</span> b.b(s + <span class="built_in">this</span>.a);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">a</span><span class="params">(String s, String s1)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> s.substring(<span class="number">0</span>, <span class="number">4</span>) + s1.substring(<span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">b</span><span class="params">(String s, String s1)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">b</span>();</span><br><span class="line">        <span class="keyword">return</span> b.a(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230107164139958.png" alt="image-20230107164139958"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230107164806955.png" alt="image-20230107164806955"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230107164832964.png" alt="image-20230107164832964"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230107164851732.png" alt="image-20230107164851732"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230107164917965.png" alt="image-20230107164917965"></p>
<h1 id="easyjava"><a href="#easyjava" class="headerlink" title="easyjava"></a>easyjava</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230107200351999.png" alt="image-20230107200351999"></p>
<p>简单分析一下这几个类然后 写一下脚本</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Boolean <span class="title function_">b</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">v</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(!s.startsWith(<span class="string">&quot;flag&#123;&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> Boolean.valueOf(<span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!s.endsWith(<span class="string">&quot;&#125;&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> Boolean.valueOf(<span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> s.substring(<span class="number">5</span>, s.length() - <span class="number">1</span>);</span><br><span class="line">        <span class="type">b</span> <span class="variable">b0</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">b</span>(((<span class="type">int</span>)<span class="number">2</span>));</span><br><span class="line">        <span class="type">a</span> <span class="variable">a0</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">a</span>(((<span class="type">int</span>)<span class="number">3</span>));</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">stringBuilder0</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">v1</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(v &lt; s1.length()) &#123;</span><br><span class="line">            stringBuilder0.append(((<span class="type">char</span>)Test.a(((<span class="type">char</span>)s1.charAt(v)) + <span class="string">&quot;&quot;</span>, b0, a0)));</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">integer0</span> <span class="operator">=</span> (<span class="type">int</span>)(((<span class="type">int</span>)b0.b()) / <span class="number">25</span>);</span><br><span class="line">            <span class="keyword">if</span>(((<span class="type">int</span>)integer0) &gt; v1 &amp;&amp; ((<span class="type">int</span>)integer0) &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">                ++v1;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ++v;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Boolean.valueOf(stringBuilder0.toString().equals(<span class="string">&quot;wigwrkaugala&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">char</span> <span class="title function_">a</span><span class="params">(String s, b b0, a a0)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a0.a(b0.a(s));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">a</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ArrayList a;</span><br><span class="line">    <span class="keyword">static</span> String b;</span><br><span class="line">    Integer[] c;</span><br><span class="line">    <span class="keyword">static</span> Integer d;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        a = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        b = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>;</span><br><span class="line">        d = (<span class="type">int</span>)<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">a</span><span class="params">(Integer integer0)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.c = <span class="keyword">new</span> <span class="title class_">Integer</span>[]&#123;((<span class="type">int</span>) <span class="number">7</span>), ((<span class="type">int</span>) <span class="number">14</span>), ((<span class="type">int</span>) <span class="number">16</span>), ((<span class="type">int</span>) <span class="number">21</span>), ((<span class="type">int</span>) <span class="number">4</span>), ((<span class="type">int</span>) <span class="number">24</span>), ((<span class="type">int</span>) <span class="number">25</span>), ((<span class="type">int</span>) <span class="number">20</span>), ((<span class="type">int</span>) <span class="number">5</span>), ((<span class="type">int</span>) <span class="number">15</span>), ((<span class="type">int</span>) <span class="number">9</span>), ((<span class="type">int</span>) <span class="number">17</span>), ((<span class="type">int</span>) <span class="number">6</span>), ((<span class="type">int</span>) <span class="number">13</span>), ((<span class="type">int</span>) <span class="number">3</span>), ((<span class="type">int</span>) <span class="number">18</span>), ((<span class="type">int</span>) <span class="number">12</span>), ((<span class="type">int</span>) <span class="number">10</span>), ((<span class="type">int</span>) <span class="number">19</span>), ((<span class="type">int</span>) <span class="number">0</span>), ((<span class="type">int</span>) <span class="number">22</span>), ((<span class="type">int</span>) <span class="number">2</span>), ((<span class="type">int</span>) <span class="number">11</span>), ((<span class="type">int</span>) <span class="number">23</span>), ((<span class="type">int</span>) <span class="number">1</span>), ((<span class="type">int</span>) <span class="number">8</span>)&#125;;</span><br><span class="line">        <span class="type">int</span> v;</span><br><span class="line">        <span class="keyword">for</span> (v = (<span class="type">int</span>) integer0; v &lt; <span class="built_in">this</span>.c.length; ++v) &#123;</span><br><span class="line">            a.add(<span class="built_in">this</span>.c[v]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> v1;</span><br><span class="line">        <span class="keyword">for</span> (v1 = <span class="number">0</span>; v1 &lt; ((<span class="type">int</span>) integer0); ++v1) &#123;</span><br><span class="line">            a.add(<span class="built_in">this</span>.c[v1]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">a</span><span class="params">()</span> &#123;</span><br><span class="line">        d = (<span class="type">int</span>) (((<span class="type">int</span>) d) + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (((<span class="type">int</span>) d) == <span class="number">25</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">v</span> <span class="operator">=</span> (<span class="type">int</span>) (((Integer) a.get(<span class="number">0</span>)));</span><br><span class="line">            a.remove(<span class="number">0</span>);</span><br><span class="line">            a.add(Integer.valueOf(v));</span><br><span class="line">            d = (<span class="type">int</span>) <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">char</span> <span class="title function_">a</span><span class="params">(Integer integer0)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">v</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">integer1</span> <span class="operator">=</span> (<span class="type">int</span>) <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (((<span class="type">int</span>) integer0) == -<span class="number">10</span>) &#123;</span><br><span class="line">            a();</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (v &lt; a.size() - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (a.get(v) == integer0) &#123;</span><br><span class="line">                integer1 = v;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ++v;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        a();</span><br><span class="line">        <span class="keyword">return</span> b.charAt(integer1.intValue());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">b</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ArrayList a;</span><br><span class="line">    <span class="keyword">static</span> String b;</span><br><span class="line">    Integer[] c;</span><br><span class="line">    <span class="keyword">static</span> Integer d;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        a = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        b = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>;</span><br><span class="line">        d = (<span class="type">int</span>)<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">b</span><span class="params">(Integer integer0)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.c = <span class="keyword">new</span> <span class="title class_">Integer</span>[]&#123;((<span class="type">int</span>) <span class="number">8</span>), ((<span class="type">int</span>) <span class="number">25</span>), ((<span class="type">int</span>) <span class="number">17</span>), ((<span class="type">int</span>) <span class="number">23</span>), ((<span class="type">int</span>) <span class="number">7</span>), ((<span class="type">int</span>) <span class="number">22</span>), ((<span class="type">int</span>) <span class="number">1</span>), ((<span class="type">int</span>) <span class="number">16</span>), ((<span class="type">int</span>) <span class="number">6</span>), ((<span class="type">int</span>) <span class="number">9</span>), ((<span class="type">int</span>) <span class="number">21</span>), ((<span class="type">int</span>) <span class="number">0</span>), ((<span class="type">int</span>) <span class="number">15</span>), ((<span class="type">int</span>) <span class="number">5</span>), ((<span class="type">int</span>) <span class="number">10</span>), ((<span class="type">int</span>) <span class="number">18</span>), ((<span class="type">int</span>) <span class="number">2</span>), ((<span class="type">int</span>) <span class="number">24</span>), ((<span class="type">int</span>) <span class="number">4</span>), ((<span class="type">int</span>) <span class="number">11</span>), ((<span class="type">int</span>) <span class="number">3</span>), ((<span class="type">int</span>) <span class="number">14</span>), ((<span class="type">int</span>) <span class="number">19</span>), ((<span class="type">int</span>) <span class="number">12</span>), ((<span class="type">int</span>) <span class="number">20</span>), ((<span class="type">int</span>) <span class="number">13</span>)&#125;;</span><br><span class="line">        <span class="type">int</span> v;</span><br><span class="line">        <span class="keyword">for</span> (v = (<span class="type">int</span>) integer0; v &lt; <span class="built_in">this</span>.c.length; ++v) &#123;</span><br><span class="line">            a.add(<span class="built_in">this</span>.c[v]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> v1;</span><br><span class="line">        <span class="keyword">for</span> (v1 = <span class="number">0</span>; v1 &lt; ((<span class="type">int</span>) integer0); ++v1) &#123;</span><br><span class="line">            a.add(<span class="built_in">this</span>.c[v1]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">a</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">v</span> <span class="operator">=</span> (<span class="type">int</span>) (((Integer) a.get(<span class="number">0</span>)));</span><br><span class="line">        a.remove(<span class="number">0</span>);</span><br><span class="line">        a.add(Integer.valueOf(v));</span><br><span class="line">        b = b + <span class="string">&quot;&quot;</span> + ((<span class="type">char</span>) b.charAt(<span class="number">0</span>));</span><br><span class="line">        b = b.substring(<span class="number">1</span>, <span class="number">27</span>);</span><br><span class="line">        d = (<span class="type">int</span>) (((<span class="type">int</span>) d) + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">a</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">v</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">integer0</span> <span class="operator">=</span> (<span class="type">int</span>) <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (b.contains(s.toLowerCase())) &#123;</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">integer1</span> <span class="operator">=</span> (<span class="type">int</span>) b.indexOf(s);</span><br><span class="line">            <span class="keyword">while</span> (v &lt; a.size() - <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (a.get(v) == integer1) &#123;</span><br><span class="line">                    integer0 = v;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                ++v;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            integer0 = s.contains(<span class="string">&quot; &quot;</span>) ? ((<span class="type">int</span>) -<span class="number">10</span>) : ((<span class="type">int</span>) -<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        a();</span><br><span class="line">        <span class="keyword">return</span> integer0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">b</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> d;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a=[<span class="number">17</span>, <span class="number">23</span>, <span class="number">7</span>, <span class="number">22</span>, <span class="number">1</span>, <span class="number">16</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">21</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">18</span>, <span class="number">2</span>, <span class="number">24</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">20</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">25</span>]</span><br><span class="line">b= [<span class="number">21</span>, <span class="number">4</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">20</span>, <span class="number">5</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">17</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">18</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">19</span>, <span class="number">0</span>, <span class="number">22</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">23</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">14</span>, <span class="number">16</span>]</span><br><span class="line">s=<span class="string">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span></span><br><span class="line">c=<span class="string">&#x27;wigwrkaugala&#x27;</span></span><br><span class="line">re=[]</span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> c:</span><br><span class="line">    re.append(b[s.index(i)])</span><br><span class="line">    <span class="built_in">print</span>(re)     <span class="comment">#先进行比较，提取出字符串</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> re:</span><br><span class="line">    d=a[i]</span><br><span class="line">    flag+=s[d]      <span class="comment">#输出对应a（）方法序列中的字符</span></span><br><span class="line">    a.append(a[<span class="number">0</span>])</span><br><span class="line">    a.remove(a[<span class="number">0</span>])</span><br><span class="line">    s+=s[<span class="number">0</span>]      <span class="comment">#对应a类中的a()那段</span></span><br><span class="line">    s=s[<span class="number">1</span>:]</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230107203402754.png" alt="image-20230107203402754"></p>
<h1 id="Ph0en1x-100"><a href="#Ph0en1x-100" class="headerlink" title="Ph0en1x-100"></a>Ph0en1x-100</h1><p>需要让我们输入的字符加密后等于getFlag()</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230107214613967.png" alt="image-20230107214613967"></p>
<p>先拿getFlag() </p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230107214812261.png" alt="image-20230107214812261"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">message</span>(<span class="params">message,data</span>):</span><br><span class="line">        <span class="comment"># 用于接收frida的信息</span></span><br><span class="line">        <span class="keyword">if</span> message[<span class="string">&quot;type&quot;</span>] == <span class="string">&#x27;send&#x27;</span>:</span><br><span class="line">            <span class="comment"># 如果类型等于 send</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[*] &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(message[<span class="string">&#x27;payload&#x27;</span>]))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(message)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># with open(&quot;1.js&quot;, &#x27;r&#x27;, encoding=&quot;utf-8&quot;) as f:</span></span><br><span class="line">    <span class="comment">#     jscode = f.read()</span></span><br><span class="line">    jscode=<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Java.perform(function () &#123;</span></span><br><span class="line"><span class="string">    let ClassName = Java.use(&quot;com.ph0en1x.android_crackme.MainActivity&quot;);</span></span><br><span class="line"><span class="string">//    这里先获取了源类 ek`fz@q2^x/t^fn0mF^6/^rb`qanqntfg^E`hq|</span></span><br><span class="line"><span class="string">    ClassName.getFlag.implementation = function (obj,str) &#123;</span></span><br><span class="line"><span class="string">        //调用  implementation 修改了 doRawData函数的实现</span></span><br><span class="line"><span class="string">        let flag = this.getFlag();</span></span><br><span class="line"><span class="string">        console.log(&quot;flag=&gt;&quot;, flag);</span></span><br><span class="line"><span class="string">        return flag;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">    device = frida.get_usb_device()</span><br><span class="line">    <span class="comment"># 获取当前的usb设备</span></span><br><span class="line">    <span class="built_in">print</span>(device)</span><br><span class="line">    process = device.attach(<span class="string">&quot;Android_crackme&quot;</span>)</span><br><span class="line">    <span class="comment"># 附加到相关进程</span></span><br><span class="line">    <span class="built_in">print</span>(process)</span><br><span class="line">    script = process.create_script(jscode)</span><br><span class="line">    <span class="comment"># 进程所需要附加的脚本</span></span><br><span class="line"></span><br><span class="line">    script.on(<span class="string">&quot;message&quot;</span>, message)</span><br><span class="line">    <span class="comment"># 将message函数与脚本内容绑定</span></span><br><span class="line">    script.load()</span><br><span class="line">    <span class="comment"># 加载脚本</span></span><br><span class="line">    sys.stdin.read()</span><br><span class="line">    <span class="comment"># 执行完停止等待用户输入</span></span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230107214758982.png" alt="image-20230107214758982"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230107214833685.png" alt="image-20230107214833685"></p>
<p>加密方法在so 发现就是将字符 –</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230107214852637.png" alt="image-20230107214852637"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">s=<span class="string">&#x27;ek`fz@q2^x/t^fn0mF^6/^rb`qanqntfg^E`hq|&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="built_in">ord</span>(i)+<span class="number">1</span>),end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230107214921433.png" alt="image-20230107214921433"></p>
<h1 id="黑客精神"><a href="#黑客精神" class="headerlink" title="黑客精神"></a>黑客精神</h1><p>简单读一下发现了这个的native方法</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230107235816006.png" alt="image-20230107235816006"></p>
<p>但是ida反编译之后并没有发现对应的方法</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230107235857775.png" alt="image-20230107235857775"></p>
<p>因此发现是动态注册的 找到JNI_onload</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230107235930299.png" alt="image-20230107235930299"></p>
<p>可以看到三个一一对应</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230108000041391.png" alt="image-20230108000041391"></p>
<p> n1 initSN </p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230108002925052.png" alt="image-20230108002925052"></p>
<p>这里可以看到 如果 &#x2F;sdcard&#x2F;reg.dat 的内容存在且为 EoPAoY62@ElRD 就将 java对象和1 传入setValue 否则传入 java对象和0</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230108001230505.png" alt="image-20230108001230505"></p>
<p>setValue a1 是传入的java对象 a2是传入的值 v4代表取com&#x2F;gdufs&#x2F;xman&#x2F;MyApp这个类 v5是取v4类中的m属性 也就是将 com&#x2F;gdufs&#x2F;xman&#x2F;MyApp 类的静态属性m设置为1或者0</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230108001455596.png" alt="image-20230108001455596"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230108005438737.png" alt="image-20230108005438737"></p>
<p>这里简单逆一下 n2</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">s = <span class="string">&quot;W3_arE_whO_we_ARE&quot;</span></span><br><span class="line">s2 = <span class="string">&quot;EoPAoY62@ElRD&quot;</span></span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line">v9 = <span class="number">2016</span></span><br><span class="line"><span class="keyword">for</span> i in range(len(s2)):</span><br><span class="line">    <span class="keyword">if</span> i%<span class="number">3</span> == <span class="number">1</span>:</span><br><span class="line">        v9 = (v9 + <span class="number">5</span>)%<span class="number">16</span></span><br><span class="line">        v11 = s[v9+<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    elif i%<span class="number">3</span> == <span class="number">2</span>:</span><br><span class="line">        v9 = (v9 + <span class="number">7</span>)%<span class="number">15</span></span><br><span class="line">        v11 = s[v9+<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        v9 = (v9 + <span class="number">3</span>) % <span class="number">13</span></span><br><span class="line">        v11 = s[v9 + <span class="number">3</span>]</span><br><span class="line">    flag += chr(ord(s2[i]) ^ ord(v11))</span><br><span class="line">    print(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230108005508288.png" alt="image-20230108005508288"></p>
<p>n3 的内容</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/img/image-20230108011041690.png" alt="image-20230108011041690"></p>
<p>别人写的frida脚本 做下记录 我没有跑成功</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//frida -U -f com.gdufs.xman -l demo.js --no-pause</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//int fputs(const char *str, FILE *stream);</span></span><br><span class="line"><span class="keyword">var</span> fputs_str = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hook_so_libc_fputs</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> libc_addr = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&quot;libc.so&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> fputs_addr = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&quot;libc.so&quot;</span>, <span class="string">&quot;fputs&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[libc.so] hooked fputs, fputs_addr=&quot;</span>+fputs_addr);</span><br><span class="line"> </span><br><span class="line">    <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(fputs_addr,&#123;</span><br><span class="line">        <span class="attr">onEnter</span>: <span class="keyword">function</span>(<span class="params">args</span>)&#123;</span><br><span class="line">            fputs_str = args[<span class="number">0</span>].<span class="title function_">readCString</span>();</span><br><span class="line">            <span class="comment">//console.log(&quot;[fputs] str=&quot;+fputs_str);</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onLeave</span>: <span class="keyword">function</span>(<span class="params">retval</span>)&#123;</span><br><span class="line"> </span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">algorithm_cracking</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">MyApp</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.gdufs.xman.MyApp&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">MyApp</span>_instance = <span class="title class_">MyApp</span>.$new();</span><br><span class="line">        <span class="keyword">var</span> dict = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ!@#$%^&amp;*()&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> ciphertext = <span class="string">&quot;EoPAoY62@ElRD&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> ciphertext_array = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="string">&quot;EoP&quot;</span>, <span class="string">&quot;AoY&quot;</span>, <span class="string">&quot;62@&quot;</span>, <span class="string">&quot;ElR&quot;</span>);</span><br><span class="line">       </span><br><span class="line">        <span class="keyword">var</span> plaintext = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> flag = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">var</span> t,i,j,k,g;</span><br><span class="line">        <span class="keyword">var</span> input;</span><br><span class="line">        <span class="keyword">for</span> (t = <span class="number">0</span>; t &lt; ciphertext_array.<span class="property">length</span>; t++) &#123;</span><br><span class="line">            flag =<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; dict.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (flag == <span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; dict.<span class="property">length</span>; j++) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (flag == <span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; dict.<span class="property">length</span>; k++) &#123;</span><br><span class="line">                        input = <span class="string">&quot;&quot;</span> + dict[i] + dict[j] + dict[k];</span><br><span class="line">                        <span class="comment">//console.log(temp);</span></span><br><span class="line">                        <span class="title class_">MyApp</span>_instance.<span class="title function_">saveSN</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.lang.String&#x27;</span>).$new(input));</span><br><span class="line">                        <span class="keyword">if</span> (fputs_str == ciphertext_array[t]) &#123;</span><br><span class="line">                            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;input=&quot;</span> + input + <span class="string">&quot;--output=&quot;</span> + fputs_str);</span><br><span class="line">                            plaintext = plaintext + input;</span><br><span class="line">                            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;plaintext=&quot;</span>+plaintext);</span><br><span class="line">                            flag = <span class="number">1</span>;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125; </span><br><span class="line"> </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; dict.<span class="property">length</span>; g++) &#123;</span><br><span class="line">            input = <span class="string">&quot;&quot;</span> + dict[g];</span><br><span class="line">            <span class="title class_">MyApp</span>_instance.<span class="title function_">saveSN</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.lang.String&#x27;</span>).$new(input));</span><br><span class="line">            <span class="keyword">if</span> (fputs_str == <span class="string">&quot;D&quot;</span>)&#123;</span><br><span class="line">                plaintext =plaintext + input;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;plaintext=&quot;</span>+plaintext);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;algorithm_cracking finished&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&#125; </span><br><span class="line"><span class="title function_">setImmediate</span>(hook_so_libc_fputs);</span><br><span class="line"><span class="built_in">setTimeout</span>(algorithm_cracking,<span class="number">3</span>*<span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/android-re/">android  re</a><a class="post-meta__tags" href="/tags/xctf/">xctf</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.pixabay.com/photo/2016/10/22/17/46/mountains-1761292_1280.jpg" data-sites="qq,wechat,weibo,facebook,twitter"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/Snipaste_2022-08-28_20-22-45.png" target="_blank"><img class="post-qr-code-img" src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/Snipaste_2022-08-28_20-22-45.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/Snipaste_2022-08-28_20-32-45.png" target="_blank"><img class="post-qr-code-img" src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/Snipaste_2022-08-28_20-32-45.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/709ffdf2.html"><img class="prev-cover" src="https://cdn.pixabay.com/photo/2016/11/06/05/36/lake-1802337_1280.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">android 逆向(bugkuctf)</div></div></a></div><div class="next-post pull-right"><a href="/67168608.html"><img class="next-cover" src="https://cdn.pixabay.com/photo/2015/10/30/20/13/sea-1014710_1280.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">LordOfTheRoot_1.0.1</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80android"><span class="toc-number">1.</span> <span class="toc-text">基础android</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Android2-0"><span class="toc-number">2.</span> <span class="toc-text">Android2.0</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#APK%E9%80%86%E5%90%91"><span class="toc-number">3.</span> <span class="toc-text">APK逆向</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%BA%E6%B0%91%E7%9A%84%E5%90%8D%E4%B9%89-%E6%8A%93%E6%8D%95%E8%B5%B5%E5%BE%B7%E6%B1%891-200"><span class="toc-number">4.</span> <span class="toc-text">人民的名义-抓捕赵德汉1-200</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#boomshakalaka-3"><span class="toc-number">5.</span> <span class="toc-text">boomshakalaka-3</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#easy-apk"><span class="toc-number">6.</span> <span class="toc-text">easy-apk</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#frida%E4%BD%BF%E7%94%A8"><span class="toc-number">7.</span> <span class="toc-text">frida使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">7.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hook"><span class="toc-number">7.2.</span> <span class="toc-text">hook</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%BD%E5%85%A5%E7%B1%BB"><span class="toc-number">7.2.1.</span> <span class="toc-text">载入类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B%E8%A1%A8%E7%A4%BA"><span class="toc-number">7.2.2.</span> <span class="toc-text">函数参数类型表示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6%E5%8F%82%E6%95%B0%E7%9A%84%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="toc-number">7.2.3.</span> <span class="toc-text">带参数的构造方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-number">7.2.4.</span> <span class="toc-text">调用函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-number">7.2.5.</span> <span class="toc-text">类型转换</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B%E5%9C%BA%E6%99%AF"><span class="toc-number">7.3.</span> <span class="toc-text">实例场景</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#app2"><span class="toc-number">8.</span> <span class="toc-text">app2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#frida"><span class="toc-number">8.1.</span> <span class="toc-text">frida</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#easy-so"><span class="toc-number">9.</span> <span class="toc-text">easy-so</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#app3"><span class="toc-number">10.</span> <span class="toc-text">app3</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#easyjava"><span class="toc-number">11.</span> <span class="toc-text">easyjava</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Ph0en1x-100"><span class="toc-number">12.</span> <span class="toc-text">Ph0en1x-100</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%BB%91%E5%AE%A2%E7%B2%BE%E7%A5%9E"><span class="toc-number">13.</span> <span class="toc-text">黑客精神</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background: linear-gradient(20deg, #0062be, #925696, #cc426e, #fb0347)"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2023 By wanan</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"></div><div id="rightside-config-show"><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'RjFSSKpeg1lxuvDjmLndzaLO-MdYXbMMI',
      appKey: '8qrAyIwMaJTebKjjzPnV0SFT',
      avatar: 'monsterid',
      serverURLs: 'https://valine.wanan.red',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://www.wanan.red/353ff66c.html'
    this.page.identifier = '/353ff66c.html'
    this.page.title = 'android 逆向(xctf)'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://www-wanan-red.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }

  document.getElementById('darkmode').addEventListener('click', () => {
    setTimeout(() => window.disqusReset(), 200)
  })
}

if ('Valine' === 'Disqus' || !false) {
  if (false) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script>(function(d, w, c) {
    w.ChatraID = 'LAbfxFAsFCbvYgjHY';
    var s = d.createElement('script');
    w[c] = w[c] || function() {
        (w[c].q = w[c].q || []).push(arguments);
    };
    s.async = true;
    s.src = 'https://call.chatra.io/chatra.js';
    if (d.head) d.head.appendChild(s);
})(document, window, 'Chatra');

if (true) {
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      Chatra('openChat')
    });
  }
  chatBtnFn()
} else {
  if (false) {
    function chatBtnHide () {
      Chatra('hide')
    }
    function chatBtnShow () {
      Chatra('show')
    }
  }
}</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>